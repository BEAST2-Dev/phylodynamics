package test.phylodynamics.epidemiology;

import org.junit.Test;
import junit.framework.TestCase;
import beast.evolution.tree.Tree;
import beast.evolution.tree.coalescent.TreeIntervals;
import beast.evolution.tree.coalescent.Coalescent;
import beast.util.TreeParser;
import beast.core.parameter.RealParameter;
import beast.phylodynamics.epidemiology.Volz2009Coalescent;
import beast.phylodynamics.epidemiology.VolzSIR;
import beast.phylodynamics.epidemiology.HybridSEIREpidemic;
import beast.phylodynamics.BDSIR;

import java.io.PrintWriter;
import java.io.FileWriter;

/**
 * Created by IntelliJ IDEA.
 * User: Denise Kuehnert
 * Date: Jun 4, 2013
 * Time: 4:36:41 PM
 */
public class volzSIRtest2 extends TestCase  {


    @Test
    public void testCompareBeta() throws Exception{

        PrintWriter writer;

        double lower = 0.0001;
        double upper = 0.01;
        int steps = 100;

        String[] trees = new String[3];

        int[] tips = new int[trees.length] ;
        //25 tips
        trees[0] = "((20:1.7327013309920987,(2:1.5699517642369987,9:1.5699517642369987):0.1627495667551):0.3906420437073396,(((((12:1.4606660366895723,((22:0.7364772016601255,21:0.7364772016601255):0.6701138844558105,(15:1.3665082235172927,((3:1.020945860930602,(8:0.8653300121493379,10:0.8653300121493379):0.155615848781264):0.22753196406186138,(7:1.1290942502849537,19:1.1290942502849537):0.1193835747075096):0.11803039852482944):0.040082862598643354):0.054074950573636205):0.0074844678674776954,((17:0.012266430667138728,23:0.012266430667138728):1.3007893648454143,(24:0.9390090648133209,5:0.9390090648133209):0.3740467306992321):0.15509470904449696):0.038425441676050665,((18:0.5287382111016794,16:0.5287382111016794):0.6219873839148018,14:1.1507255950164812):0.35585035121661945):0.17026942978592519,11:1.6768453760190258):0.3913503628622723,((13:0.7724098713155667,(25:0.07463738743032255,4:0.07463738743032255):0.6977724838852442):0.9249671690996732,(6:1.2765864559055629,1:1.2765864559055629):0.4207905845096771):0.3708186984660582):0.05514763581814014);";
        tips[0] = 25;

        //100 tips
        trees[1] = "(((((((23:1.0729547961644852,87:1.0729547961644852):0.096868837962653,57:1.1698236341271382):0.29797542535649635,(49:0.4094197776035071,(38:0.26550131145540634,95:0.26550131145540634):0.14391846614810078):1.0583792818801274):0.18032431960619755,73:1.648123379089832):0.08457795190226658,((62:0.8916263609258532,(84:0.5559563842353992,18:0.5559563842353992):0.33566997669045406):0.6783254033111454,(((((63:0.034945690780505245,97:0.034945690780505245):0.19242962254313856,9:0.2273753133236438):0.17549828083562113,((100:0.1741695939807646,28:0.1741695939807646):0.19993388204264573,(27:0.050408750672636504,59:0.050408750672636504):0.3236947253507738):0.028770118135854617):0.23343520726585498,13:0.6363088014251199):0.2880502604352615,(8:0.24752128676124308,64:0.24752128676124308):0.6768377750991383):0.6455927023766173):0.1627495667551):0.1616741410359196,52:1.8943754720280181):0.22896790267142003,(((((((7:0.5219419396059459,36:0.5219419396059459):0.5436790470419539,(54:0.8255077596871783,(14:0.6783726653136515,96:0.6783726653136515):0.1471350943735268):0.24011322696072157):0.39504505004167245,((1:0.7364772016601258,31:0.7364772016601258):0.6701138844558105,((33:0.6838921123380322,((((19:0.056331038895975016,70:0.056331038895975016):0.20540748701885736,37:0.2617385259148324):0.2266784992072739,25:0.4884170251221063):0.024949902744727748,2:0.513366927866834):0.17052518447119813):0.6826161111792608,(((3:1.0617729361589328,78:1.0617729361589328):0.06500744366185152,((17:0.8999537633642907,(40:0.17317170680705862,98:0.17317170680705862):0.726782056557232):0.12099209756631146,((43:0.6541678249491143,75:0.6541678249491143):0.307507747966552,((42:0.18571664984559622,88:0.18571664984559622):0.6796133623037419,56:0.8653300121493381):0.09634556076632816):0.059270288014935835):0.10583451889018214):0.12169744517167924,(((50:0.24626376861760324,34:0.24626376861760324):0.3103536651529033,20:0.5566174337705065):0.5724768165144474,((26:0.048359004317534815,30:0.048359004317534815):0.8507697951557018,(24:0.5499912208947262,79:0.5499912208947262):0.34913757857851047):0.22996545081171726):0.1193835747075096):0.11803039852482944):0.040082862598643354):0.05407495057363598):0.0074844678674776954,(((82:0.5470739778509324,(69:0.012266430667138728,55:0.012266430667138728):0.5348075471837936):0.7625820889503805,((93:0.9434330370416533,(6:0.30722611329775207,46:0.30722611329775207):0.6362069237439012):0.32781197583206234,81:1.2712450128737156):0.03841105392759725):0.0033997287112403907,((65:0.12866328651754833,47:0.12866328651754833):0.8103457782957728,(89:0.7656118147305466,(85:0.5850056802792643,44:0.5850056802792643):0.18060613445128237):0.1733972500827745):0.3740467306992321):0.15509470904449674):0.038425441676050665,((77:0.9677314899312848,61:0.9677314899312848):0.2348247769399423,(((35:0.669272187907731,(68:0.47467961905813105,(83:0.15807346740028194,91:0.15807346740028194):0.3166061516578491):0.19459256884959997):0.0010930897008205598,(((29:0.47410868950259966,71:0.47410868950259966):0.003475660991485885,94:0.47758435049408554):0.05115386060759408,(15:0.35364413984485843,5:0.35364413984485843):0.1750940712568212):0.14162706650687196):0.48036031740792984,(((76:0.8742716259624972,(92:0.24275892340809557,16:0.24275892340809557):0.6315127025544016):0.08721296138400114,99:0.9614845873464983):0.10346825662582781,(32:1.0605654013113666,(21:0.9443702255328097,((41:0.21100802668854302,22:0.21100802668854302):0.600667885920686,67:0.811675912609229):0.1326943129235807):0.11619517577855687):0.004387442660959584):0.08577275104415527):0.05183067185474566):0.3040196793618736):0.17026942978592519,((48:0.04343070490977441,11:0.04343070490977441):1.3833112744810068,51:1.4267419793907812):0.25010339662824466):0.3913503628622723,((10:0.7724098713155669,(80:0.07463738743032255,66:0.07463738743032255):0.6977724838852444):0.924967169099673,(60:1.4655473062347908,((74:1.2898633104726591,(((4:1.1362824399975748,(53:1.0281496548130773,72:1.0281496548130773):0.10813278518449754):0.01609087084087868,58:1.1523733108384535):0.12421314506710956,((90:0.49465986133119433,45:0.49465986133119433):0.6276723007800018,86:1.1223321621111961):0.15425429379436695):0.013276854567096041):0.1291352770611054,(39:0.114182440439905,12:0.114182440439905):1.3048161470938595):0.04654871870102628):0.23182973418044917):0.3708186984660582):0.05514763581814014);";
        tips[1]=100;

        // all 245 tips
        trees[2] = "(((((((((((233:0.6955967111603156,198:0.6955967111603156):0.14021726278152546,79:0.8358139739418411):0.2371408222226441,(172:0.35672813225298183,(30:0.11114029483538612,35:0.11114029483538612):0.2455878374175957):0.7162266639115034):0.096868837962653,(((38:0.3735191185528217,32:0.3735191185528217):0.39229959315571605,(224:0.3886510272331738,229:0.3886510272331738):0.377167684475364):0.08685215563597892,(101:0.24682061936594568,196:0.24682061936594568):0.605850247978571):0.3171527667826215):0.14657273838145435,240:1.3163963725085925):0.151402686975042,(148:0.8502621462463897,((187:0.2218914614395655,227:0.2218914614395655):0.1875283161639416,((203:0.0143421338853984,189:0.0143421338853984):0.25115917757000794,234:0.26550131145540634):0.14391846614810078):0.4408423686428826):0.6175369132372448):0.07507504401318077,(116:0.21804866081771657,186:0.21804866081771657):1.3248254426790989):0.10524927559301678,(108:0.5575308819625084,90:0.5575308819625084):1.0905924971273238):0.08457795190226658,(((((46:0.25823318903568193,99:0.25823318903568193):0.6298639004154232,115:0.8880970894511051):0.00352927147474813,(((((237:0.20741715038729058,36:0.20741715038729058):0.18443102512754628,212:0.39184817551483686):0.0032976040457390887,(124:0.23283126437516266,161:0.23283126437516266):0.1623145151854133):0.011369160272506118,9:0.40651493983308207):0.1494414444023171,220:0.5559563842353992):0.33566997669045406):0.3165344934937879,118:1.2081608544196412):0.3617909098173575,((((((162:0.034945690780505245,132:0.034945690780505245):0.19242962254313856,42:0.2273753133236438):0.17549828083562113,(((164:0.02493672768545574,60:0.02493672768545574):0.14923286629530885,(31:2.861517250267731E-4,207:2.861517250267731E-4):0.17388344225573782):0.19993388204264573,(71:0.22184743146580654,(157:0.050408750672636504,80:0.050408750672636504):0.17143868079317004):0.15225604455760378):0.028770118135854617):0.23343520726585498,154:0.6363088014251199):0.2880502604352615,(((111:0.03219949787489451,94:0.03219949787489451):0.17503222233260063,(199:0.017591236215728223,104:0.017591236215728223):0.18964048399176692):0.040289566553747935,141:0.24752128676124308):0.6768377750991383):0.355313383051572,84:1.2796724449119534):0.29027931932504525):0.1627495667551):0.1616741410359196,(214:1.5211513817045366,((86:0.6423759217102636,((236:0.3322929367219407,185:0.3322929367219407):0.1827825144107429,231:0.5150754511326836):0.12730047057757998):0.73511664196663,((180:0.3862334779611709,158:0.3862334779611709):0.5225168133863127,(54:0.0995536332436231,119:0.0995536332436231):0.8091966581038605):0.4687422723294099):0.1436588180276429):0.3732240903234818):0.22896790267142003,((((((((((48:0.4241004269162314,243:0.4241004269162314):0.09784151268971453,((74:0.04626858886278473,45:0.04626858886278473):0.3274362112137248,92:0.3737048000765095):0.1482371395294364):0.5175644010452773,225:1.0395063406512233):0.026114645996676566,(((83:0.1946664410900527,112:0.1946664410900527):0.2158928831153264,238:0.4105593242053791):0.41494843548179916,((95:0.6624421630615618,(98:0.3736316787398084,63:0.3736316787398084):0.2888104843217534):0.015930502252089696,47:0.6783726653136515):0.1471350943735268):0.24011322696072157):0.031243061705280573,73:1.0968640483531804):0.3638019883363919,((((160:0.11211745172100596,213:0.11211745172100596):0.16150366590205723,197:0.2736211176230632):0.4628560840370626,33:0.7364772016601258):0.6701138844558105,(((120:0.4487509591897667,204:0.4487509591897667):0.23514115314826545,((((117:0.23445717567867108,((137:0.056331038895975016,40:0.056331038895975016):0.12404803586902835,(139:0.10310711691621854,122:0.10310711691621854):0.07727195784878482):0.054078100913667715):0.027281350236161295,191:0.2617385259148324):0.2266784992072739,(((107:0.05571036530712714,93:0.05571036530712714):0.12217386013969955,205:0.1778842254468267):0.061749174821942976,72:0.23963340026876967):0.2487836248533366):0.024949902744727748,(64:0.3232306519751287,66:0.3232306519751287):0.19013627589170534):0.17052518447119813):0.6826161111792608,(((134:1.0617729361589328,(3:0.369845068592098,133:0.369845068592098):0.6919278675668348):0.06500744366185152,(((((232:0.021546584301352034,244:0.021546584301352034):0.344142745051379,59:0.365689329352731):0.08940911502227822,(51:0.06065352159978854,155:0.06065352159978854):0.3944449227752207):0.44485531898928143,(200:0.17317170680705862,169:0.17317170680705862):0.726782056557232):0.12099209756631146,((145:0.6541678249491143,(125:0.6113229366929425,18:0.6113229366929425):0.04284488825617183):0.307507747966552,(((173:0.18571664984559622,109:0.18571664984559622):0.17867471364482457,(7:0.0658969433606229,215:0.0658969433606229):0.2984944201297979):0.5009386486589174,85:0.8653300121493381):0.09634556076632816):0.059270288014935835):0.10583451889018214):0.12169744517167924,((((70:0.24626376861760324,68:0.24626376861760324):0.202113365316825,(194:0.2759212994177287,129:0.2759212994177287):0.17245583451669955):0.1082402998360783,57:0.5566174337705065):0.5724768165144474,((44:0.8676844249624589,(81:0.048359004317534815,223:0.048359004317534815):0.8193254206449241):0.03144437451077775,(((((135:0.02217996438076053,37:0.02217996438076053):0.20079958631531447,15:0.222979550696075):0.30733208388215183,210:0.5303116345782268):0.019679586316499353,241:0.5499912208947262):0.10025402948977513,52:0.6502452503845013):0.24888354908873533):0.22996545081171726):0.1193835747075096):0.11803039852482944):0.040082862598643354):0.05407495057363598):0.0074844678674776954,((((230:0.20357841368630236,50:0.20357841368630236):0.34349556416463,(178:0.012266430667138728,96:0.012266430667138728):0.5348075471837936):0.7625820889503805,((28:0.9434330370416533,(((61:0.07242909393280295,23:0.07242909393280295):0.23479701936494912,67:0.30722611329775207):0.11523249249406309,100:0.42245860579181516):0.5209744312498381):0.32781197583206234,5:1.2712450128737156):0.03841105392759725):0.0033997287112403907,(((235:0.02789630554792666,103:0.02789630554792666):0.10076698096962167,6:0.12866328651754833):0.8103457782957728,((21:0.05467586259720836,127:0.05467586259720836):0.7499656993517843,(174:0.7656118147305466,(142:0.5850056802792643,102:0.5850056802792643):0.18060613445128237):0.03902974721844599):0.13436750286432853):0.3740467306992321):0.15509470904449674):0.038425441676050665,((136:0.9677314899312848,(((146:0.011349922960334435,239:0.011349922960334435):0.2842512119673697,(201:0.11182495242383439,177:0.11182495242383439):0.18377618250386973):0.3129454953546442,(143:0.0035453008061563374,216:0.0035453008061563374):0.605001329476192):0.3591848596489364):0.2348247769399423,(((((149:0.22758379023380604,166:0.22758379023380604):0.441688397673925,((41:0.3322776423307512,17:0.3322776423307512):0.14240197672737986,((152:0.18721514171821152,159:0.18721514171821152):0.06417088823374106,((226:0.15128689471622314,179:0.15128689471622314):0.0067865726840588,167:0.15807346740028194):0.09331256255167064):0.22329358910617847):0.19459256884959997):0.0010930897008205598,(((((130:0.13697614690031212,19:0.13697614690031212):0.1556390440223976,(221:0.10231532304161384,113:0.10231532304161384):0.19029986788109587):0.18149349857988994,(110:0.18834896760392006,20:0.18834896760392006):0.2857597218986796):0.003475660991485885,(14:0.07492552776593131,217:0.07492552776593131):0.40265882272815423):0.05115386060759408,(53:0.35364413984485843,140:0.35364413984485843):0.1750940712568212):0.14162706650687196):0.38161461281194176,245:1.0519798904204933):0.09874570459598808,((156:0.9507599951088002,((121:0.004259389439384087,123:0.004259389439384087):0.06344738090632385,39:0.06770677034570793):0.8830532247630922):0.19462081399941344,(((((114:0.47470230915442047,34:0.47470230915442047):0.16424582016417677,((65:0.22392905261685803,105:0.22392905261685803):0.3909817191951903,(((29:0.0791638720399086,69:0.0791638720399086):0.039560932068283705,181:0.1187248041081923):0.28923515555720103,208:0.40795995966539333):0.206950812146655):0.024037357506548895):0.23532349664389995,((106:0.0015754429076402232,43:0.0015754429076402232):0.24118348050045535,126:0.24275892340809557):0.6315127025544016):0.08721296138400114,(((2:0.0304985617330793,4:0.0304985617330793):0.00863604774277027,168:0.03913460947584957):0.8163217477494533,(175:0.20482219199414375,76:0.20482219199414375):0.6506341652311591):0.10602823012119544):0.10346825662582781,((55:0.3951313616811536,8:0.3951313616811536):0.665434039630213,((((58:0.6203790340924247,(88:0.3838148173248017,218:0.3838148173248017):0.23656421676762296):0.0307294654231558,171:0.6511084995155805):0.04984065823744177,195:0.7009491577530222):0.24342106777978745,((151:0.21100802668854302,49:0.21100802668854302):0.600667885920686,16:0.811675912609229):0.1326943129235807):0.11619517577855687):0.004387442660959584):0.08042796513588746):0.005344785908267813):0.05183067185474566):0.3040196793618736):0.17026942978592519,((((27:0.008745783438392607,176:0.008745783438392607):0.0346849214713818,82:0.04343070490977441):0.2166861390994037,193:0.2601168440091781):1.166625135381603,((12:0.2814908996940111,97:0.2814908996940111):0.8716791748539319,(25:0.41496509775598067,((188:0.018499592191076886,138:0.018499592191076886):0.25668984144183504,89:0.27518943363291193):0.13977566412306874):0.7382049767919623):0.2735719048428382):0.25010339662824466):0.3913503628622723,(((((182:0.2836112687761534,242:0.2836112687761534):0.08505667133173889,11:0.3686679401078923):0.21699666682762087,131:0.5856646069355131):0.1867452643800538,(((153:0.10983208776720721,228:0.10983208776720721):0.20167938981497846,211:0.31151147758218567):0.146907349821229,((24:0.07463738743032255,190:0.07463738743032255):0.3750026945181548,147:0.4496400819484774):0.008778745454937287):0.31399104391215227):0.924967169099673,((183:0.1626887650299671,87:0.1626887650299671):1.3028585412048237,((((192:1.0086093884575675,(184:0.9581405521641553,163:0.9581405521641553):0.050468836293412256):0.2812539220150916,(((((75:0.5980640452438888,165:0.5980640452438888):0.4282395110734112,78:1.0263035563173):0.10997888368027486,((((144:0.07076058964647514,13:0.07076058964647514):0.21414114144085605,128:0.2849017310873312):0.38482005694835086,26:0.669721788035682):0.35842786677739524,170:1.0281496548130773):0.10813278518449754):0.01609087084087868,(22:0.025400280250206908,1:0.025400280250206908):1.1269730305882466):0.12421314506710956,(((91:0.49465986133119433,206:0.49465986133119433):0.28429416551135644,62:0.7789540268425508):0.34337813526864536,(209:0.7202780440806722,(219:0.06423486056776584,56:0.06423486056776584):0.6560431835129064):0.40205411803052393):0.15425429379436695):0.013276854567096041):0.1291352770611054,((10:0.114182440439905,222:0.114182440439905):0.8648036753645074,150:0.9789861158044124):0.4400124717293521):0.03990426993392382,(202:0.920512328860912,77:0.920512328860912):0.5383905286067763):0.006644448767102462):0.23182973418044917):0.3708186984660582):0.05514763581814014);";
        tips[2] = 245;

        Tree tree ;

        double logLvc ;

        for (int j=0;j<trees.length;j++){
//        for (int j=0;j<1;j++){


            writer = new PrintWriter(new FileWriter("/Users/Denise/Documents/Projects/BDSIR/coalComp/vary_beta_"+ j +".txt"));
            writer.println("#tree = " + trees[j]);
            writer.println("#tips = " + tips[j]);

            tree = new TreeParser(trees[j],false);

            TreeIntervals treeIntervals = new TreeIntervals();
            treeIntervals.init(tree);

            double step = (upper - lower) / (steps);

            Volz2009Coalescent vc;
            VolzSIR vvc;
            Coalescent coal;
            BDSIR bdsir;

            Double current;

            Double death = 2.;
            Double origin = 2.5;

            writer.println("beta\tvolzSIR\tvolz2009\tBDSIR");

            for (int i=1; i<=steps; i++){

                current = lower + i*step;

//            writer.println("beta = " + current);
                writer.print(current + "\t");

                vc =  new Volz2009Coalescent();
                vc.setInputValue("treeIntervals", new TreeIntervals(tree));
                vc.setInputValue("beta", new RealParameter(new Double[]{current}));
                vc.setInputValue("delta", new RealParameter("2"));
                vc.setInputValue("S0", new RealParameter("1000."));
                vc.setInputValue("T", new RealParameter("2.5"));

                try{

                    vc.initAndValidate();
                    logLvc =  vc.calculateLogP();

                }catch(Exception e){
                    logLvc = Double.NaN;
                }

                vvc = new VolzSIR();
                vvc.setInputValue("beta", new RealParameter(new Double[]{current}));
                vvc.setInputValue("gamma", new RealParameter("2"));
                vvc.setInputValue("n_S0", new RealParameter("1000."));
                vvc.setInputValue("origin", new RealParameter("2.5"));
                vvc.setInputValue("integrationStepCount", 1000);

                vvc.initAndValidate();

                HybridSEIREpidemic sir = new HybridSEIREpidemic();
                sir.initByName(
                        "tree", tree,
                        "birth", new RealParameter(new Double[]{current}),
                        "death","2",
                        "sampling", "0",
                        "origin", new RealParameter("2.5"),
                        "S0", new RealParameter(new Double[]{1000.}),
                        "Nt", "10001",
                        "Nsamples", "101" ,
                        "simulationType", "SAL"
                    ,"isDeterministic", "true"
                );

                sir.initTraj(current, 0., new Double[]{death}, new Double[]{0.}, origin, tree.getLeafNodeCount(), 100, 1000, sir.times);


                bdsir = new BDSIR();
                bdsir.setInputValue("tree", tree);
                bdsir.setInputValue("birthRate", new RealParameter(new Double[]{current*1000}));
                bdsir.setInputValue("deathRate", new RealParameter("2"));
                bdsir.setInputValue("samplingRate", new RealParameter("0"));
                bdsir.setInputValue("rho", new RealParameter(new Double[]{tips[j]/245.}));
                bdsir.setInputValue("S0", new RealParameter("1000."));
                bdsir.setInputValue("origin", new RealParameter("2.5"));
                bdsir.setInputValue("dS", new RealParameter(sir.get_dS()));
                bdsir.setInputValue("dR", new RealParameter(sir.get_dR()));
                bdsir.setInputValue("checkTreeConsistent", false);

                bdsir.initAndValidate();

                coal = new Coalescent();
                coal.initByName("treeIntervals", treeIntervals, "populationModel", vvc);


                double logLvvc =  coal.calculateLogP();
//            writer.println("volzSIR (Tim)  logL = " + logLvvc);
                writer.print((Double.isInfinite(logLvvc)?"NA":logLvvc) + "\t");


//            writer.println("volz2009coalescent logL = " + logLvc);
                writer.print((Double.isInfinite(logLvc)?"NA":logLvc) + "\t");

                double logLbdsir ;
                try{

                    logLbdsir =  bdsir.calculateTreeLogLikelihood(tree);

                }catch(Exception e){
                    logLbdsir = Double.NaN;
                }


//            writer.println("bdsir logL = " + logLbdsir);
                writer.println((Double.isInfinite(logLbdsir)?"NA":logLbdsir) + "\t");

                //        assertEquals(-19.0198, vc.calculateLogP(), 1e-5);
//            assertEquals(logLvvc, logLvc, 1e-5);



            }
            writer.flush();
            writer.close();

        }
    }


    @Test
    public void testCompareGamma() throws Exception{

        PrintWriter writer;

        double lower = .01;
        double upper = 4;
        int steps = 100;

        String[] trees = new String[3];

        int[] tips = new int[trees.length] ;
        //25 tips
        trees[0] = "((((((((((((((((7:0.0143421338853984):0.20785957338897454):0.0432996041810334):0.14391846614810078):0.37081619845199487):0.07002617019088775):0.15339239567885343):0.2918517026058338):0.17229281495255755):0.07507504401318077):0.10524927559301678):0.08457795190226658,((((((((((8:0.7720204711856193):0.11607661826548576):0.002436661133942586):0.0010926103408055443):0.16391086024258117):0.011701488700661233):0.14092214455054553):0.2340707890410838):0.1277201207762737,(((((((((((((24:2.861517250267731E-4):0.17388344225573782):0.04404101036417485):0.15589287167847088):0.028770118135854617):0.052657424686713306):0.18077778257914168):0.17231167188120433):0.028148104791981376):0.08759048376207579):0.355313383051572):0.010792873641607192):0.14244055560279056):0.1370458900806475):0.042956592966824636):0.11979297378827536):0.1616741410359196):0.22896790267142003,((((((((((((((((((3:0.3736316787398084):0.2515592624450065):0.0372512218767469):0.009564035857723363):0.0063664663943663324):0.01326105604036254):0.13387403833316425):0.24011322696072157):0.031243061705280573):0.0947324717274971):0.2690695166088948,(((((((((((((5:0.11211745172100596):0.05319121815408856):0.005293611760161632):0.10301883598780703):0.18666824042432584):0.014771496517346439):0.07462525517953766):0.18679109191585264,1:0.7364772016601258):0.1387364300124001):0.0739889944819303):0.0639896908972466):0.04250068534935325):0.3508980837148803,((((((((((((6:0.056331038895975016):0.12404803586902835):0.054078100913667715):0.027281350236161295):0.2266784992072739):0.024949902744727748):0.17052518447119813):0.3343521546993391):0.14078718006501556):0.07871842204764423):0.10331217049307906):0.02544618387418285,((((((((((((10:0.17317170680705862):0.08454901978202889):0.5197085655621294):0.026036736565057117):0.09648773464801663):0.12099209756631146,(((((((22:0.18571664984559622):0.17867471364482457):0.3290929088270722):0.04555841519489978):0.12628732463694536,(((15:0.7601879802148703):0.026963297231470618):0.06068862113203921):0.017490113570957977):0.025588099317396917):0.07075746144893125):0.059270288014935835):0.10583451889018214):0.0030242958278119403):0.015465737556799475):0.10320741178706783,((((((20:0.24626376861760324):0.12744868322911307):0.07466468208771193):0.1082402998360783):0.0809251028563962):0.49155171365805117,(((((14:0.048359004317534815):0.44896214257134437):0.07522974332834309):0.2951335347452366):0.03144437451077775):0.22996545081171726):0.1193835747075096):0.008850564382922643):0.04501758695019498):0.06416224719171182):0.040082862598643354):0.05407495057363598):0.0074844678674776954,(((((((25:0.012266430667138728,9:0.012266430667138728):0.5260017224092917):0.00239774103653545):0.00640808373796653):0.7625820889503805):0.0033997287112403907,((((((18:0.12866328651754833):0.4402161678399221):0.08150727206094377):0.10347433302491194):0.18514800536999498,(((((2:0.14637338168470126):0.4314734671151028):0.00715883147946017):0.18060613445128237):0.03902974721844599):0.13436750286432853):0.35330057839489504):0.020746152304337073):0.08288253594316153):0.07221217310133521):0.011586884164399347):0.026838557511651318,(((((((((((((16:0.13697614690031212):0.1212878255135239):0.03435121850887368):0.18149349857988994):0.003475660991485885):0.05115386060759408,(12:0.35364413984485843):0.1750940712568212):0.14162706650687196):0.26770654920188974):0.11390806361005201):0.09874570459598808,(((((((23:0.6457470832204486):0.1659288293887804):0.11765267690171721):0.01504163602186348):0.11619517577855687):0.004387442660959584):0.08042796513588746):0.005344785908267813):0.03579227956515596):0.016038392289589698):0.10702577115886203):0.19699390820301155):0.13443669613829445):0.03583273364763073,(((((((4:0.008745783438392607):0.0346849214713818):0.2166861390994037):0.629254581686324):0.3868382379538642):0.1505323157414149):0.1775531818809748):0.07255021474726986):0.23484507995615922):0.1565052829061131,(((((((((17:0.2836112687761534):0.01782696440852849):0.0672297069232104):0.21689806720239635):9.859962522451582E-5):0.1867452643800538,(((13:0.07463738743032255,21:0.07463738743032255):0.3750026945181548):0.008778745454937287):0.31399104391215227):0.8088471308087863):0.11612003829088668,(((((((((((((11:0.020434779694522565):0.6743911252862524):0.19992829117104494):0.07957332631330982):0.05382213234794753):0.10813278518449754):0.01609087084087868):0.12421314506710956,(((((((((((19:0.05822482764960091):0.4364350336815934):0.24431708492186632):0.03997708058949012):0.04963715084153453):0.0214569641504454):0.11094430297978453):0.13813436408508584):0.023205353211795066):0.005154751165386218):0.13122777215302261):0.017871770475958115):0.013276854567096041):0.09255231750765325):0.03658295955345214):0.03990426993392382):0.006644448767102462):0.23182973418044917):0.05432609977817593):0.31649259868788227):0.05514763581814014):0.10705313422705925):0.0030315770852450963);";
        tips[0] = 25;

        //100 tips
        trees[1] = "((((((((((((((((13:0.32093540208008164):0.060975097233229025):0.31368621184700496):0.14021726278152546):0.2371408222226441,(((31:0.11114029483538612):0.2455878374175957):0.5410016457715401):0.17522501813996327):0.096868837962653,((((99:0.3886510272331738):0.09381552317562081):0.28335216129974317):0.08685215563597892):0.3171527667826215):0.14657273838145435):0.10072403145482123):0.05067865552022077,((((((37:0.2218914614395655):0.1875283161639416,(((72:0.0143421338853984):0.20785957338897454):0.0432996041810334,34:0.26550131145540634):0.14391846614810078):0.37081619845199487):0.07002617019088775):0.15339239567885343):0.2918517026058338):0.17229281495255755):0.07507504401318077):0.10524927559301678,((((((((86:0.1860500785885586):0.37148080337394984):0.05751608996370239):0.00139645605243377):0.10281120115470532):0.12469517192360757):0.18965902688866731):0.07768108455947198):0.5368334665847353):0.08457795190226658,((((((((((52:0.7720204711856193):0.11607661826548576):0.002436661133942586):0.0010926103408055443,((((((47:0.23283126437516266):0.1623145151854133):0.011369160272506118):0.1494414444023171,(24:0.17364024731248184):0.3823161369229173):0.10880606135230275):0.16758150566960417):0.05928240966854714):0.16391086024258117):0.011701488700661233):0.14092214455054553):0.2340707890410838):0.1277201207762737,((((((((((((15:0.034945690780505245,19:0.034945690780505245):0.18690575707525925):0.0055238654678793075,21:0.2273753133236438):0.17549828083562113,((((17:0.02493672768545574):0.14923286629530885,(76:2.861517250267731E-4):0.17388344225573782):0.04404101036417485):0.15589287167847088,(((82:0.050408750672636504,67:0.050408750672636504):0.17143868079317004):0.04446747285853103):0.10778857169907274):0.028770118135854617):0.052657424686713306):0.18077778257914168,((51:0.38477362757472466):0.04431931356343455):0.2072158602869607):0.17231167188120433):0.028148104791981376):0.08759048376207579,((((94:0.017591236215728223):0.18964048399176692):0.040289566553747935,6:0.24752128676124308):0.3467870959051169):0.3300506791940214):0.355313383051572):0.010792873641607192):0.14244055560279056):0.1370458900806475):0.042956592966824636):0.11979297378827536):0.1616741410359196,((((((((((40:0.36616875213493794):0.07379050553556743):0.09240672376110326):0.11000994027865496):0.07793440141201247):0.014375082143032625):0.16257487491722755):0.4802322834943573):0.006527587862507511):0.1371312301651354):0.3732240903234818):0.22896790267142003,(((((((((((((((80:0.4241004269162314):0.04886338982182892):0.04897812286788561,(57:0.3737048000765095):0.1482371395294364):0.5175644010452773):0.026114645996676566,(((41:0.1946664410900527):0.2158928831153264):0.41494843548179916,((((((87:0.3736316787398084):0.2515592624450065):0.0372512218767469):0.009564035857723363):0.0063664663943663324,83:0.6783726653136515):0.01326105604036254):0.13387403833316425):0.24011322696072157):0.031243061705280573):0.0947324717274971):0.2690695166088948,(((((((((((((36:0.11211745172100596):0.05319121815408856):0.005293611760161632):0.10301883598780703):0.18666824042432584):0.014771496517346439):0.07462525517953766):0.18679109191585264,75:0.7364772016601258):0.1387364300124001):0.0739889944819303):0.0639896908972466):0.04250068534935325):0.3508980837148803,(((((((((56:0.2925293030227234):0.1562216561670433):0.04881259516803205):0.1863285579802334,((((((26:0.056331038895975016,66:0.056331038895975016):0.12404803586902835):0.054078100913667715):0.027281350236161295,81:0.2617385259148324):0.2266784992072739,(((89:0.05571036530712714):0.12217386013969955):0.061749174821942976):0.2487836248533366):0.024949902744727748,((20:0.3232306519751287):0.07811221568637183):0.11202406020533351):0.17052518447119813):0.3343521546993391):0.14078718006501556):0.07871842204764423):0.10331217049307906):0.02544618387418285,(((((((((((((((68:0.2583299982576541):0.22951007825704028):0.18369731654048405):0.16691282620794):0.020850345304575413):0.015937366433874223):0.01411639985387092):0.06279173930680826):0.10962686599668547,((((((96:0.2811005327299019):0.0887445358621961):0.1609876213932513):0.19483207805907932):0.022828470516035537):0.1818843615121788):0.13139533608628984):0.06500744366185152,(((((11:0.021546584301352034):0.344142745051379):0.08940911502227822):0.44485531898928143,((((5:0.17317170680705862,74:0.17317170680705862):0.08454901978202889):0.5197085655621294):0.026036736565057117):0.09648773464801663):0.12099209756631146,(((((90:0.26736825607667125):0.04783629408263801):0.003256855981669027):0.335706418808136,(((12:0.22557136133512268):0.2073587081558772):0.17839286720194258):0.04284488825617183):0.307507747966552,((((((98:0.18571664984559622,23:0.18571664984559622):0.17867471364482457):0.3290929088270722):0.04555841519489978):0.12628732463694536,(((14:0.7601879802148703):0.026963297231470618):0.06068862113203921):0.017490113570957977):0.025588099317396917):0.07075746144893125):0.059270288014935835):0.10583451889018214):0.0030242958278119403):0.015465737556799475):0.10320741178706783,((((((32:0.24626376861760324,16:0.24626376861760324):0.12744868322911307):0.07466468208771193):0.1082402998360783,(64:0.3091827356676293):0.24743469810287722):0.0809251028563962):0.49155171365805117,(((((43:0.048359004317534815,8:0.048359004317534815):0.44896214257134437):0.07522974332834309):0.2951335347452366):0.03144437451077775,(((((((48:0.222979550696075):0.29467528488185213):0.012656799000299701):0.019679586316499353,7:0.5499912208947262):0.025029094913389782):0.07522493457638535):0.08861795875904366):0.16026559032969168):0.22996545081171726):0.1193835747075096):0.008850564382922643):0.04501758695019498):0.06416224719171182):0.040082862598643354):0.05407495057363598):0.0074844678674776954,(((((78:0.20357841368630236):0.34349556416463,(((59:0.012266430667138728,55:0.012266430667138728):0.5260017224092917):0.00239774103653545):0.00640808373796653):0.7625820889503805,(((((71:0.9295311190060562):0.013901918035597038,(((((4:0.07242909393280295):0.23479701936494912,49:0.30722611329775207):0.11523249249406309):0.14850950427796028):0.29589919873956205):0.07656572823231578):0.023237353600260358):0.06386482739098565):0.24070979484081634,(((((69:0.5348631098745045):0.11637661069513672):0.3412667862870975):0.034246836978997):0.08688807903336637):0.15760359000461355):0.03841105392759725):0.0033997287112403907,(((((((54:0.02789630554792666):0.10076698096962167,88:0.12866328651754833):0.4402161678399221):0.08150727206094377):0.10347433302491194):0.18514800536999498,(((38:0.5270497024277361):0.23856211230281055,((84:0.543567494050625):0.04143818622863926,((30:0.14637338168470126):0.4314734671151028):0.00715883147946017):0.18060613445128237):0.03902974721844599):0.13436750286432853):0.35330057839489504):0.020746152304337073):0.08288253594316153):0.07221217310133521):0.011586884164399347):0.026838557511651318,((((((((((9:0.46907201670194976):0.14114594598201324):0.14270389478931533):0.02353714022280573):0.1912724922352007,((((29:0.11182495242383439):0.18377618250386973):0.09496216216272835):0.21798333319191587):0.3591848596489364):0.006808677675159691):0.05209742884029245):0.1690511914287287):0.006867478995761456,((((((((91:0.22758379023380604):0.4213364787555536):0.020351918918371403,((27:0.3322776423307512):0.14240197672737986,(((97:0.15128689471622314):0.0067865726840588,46:0.15807346740028194):0.09331256255167064):0.22329358910617847):0.19459256884959997):0.0010930897008205598,((((((25:0.13697614690031212):0.1212878255135239):0.03435121850887368):0.18149349857988994,(58:0.18834896760392006):0.2857597218986796):0.003475660991485885,(((77:0.07492552776593131):0.24780331920546006):0.1535526813866661):0.001302822136028059):0.05115386060759408,((50:0.24055708552318356):0.11308705432167487,79:0.35364413984485843):0.1750940712568212):0.14162706650687196):0.26770654920188974):0.11390806361005201):0.09874570459598808,(((((((((92:0.0791638720399086):0.039560932068283705):0.28923515555720103):0.206950812146655):0.024037357506548895):0.23532349664389995,(((62:0.0015754429076402232):0.24118348050045535,65:0.24275892340809557):0.3581719590468695):0.2733407435075321):0.08721296138400114,(((((33:0.03913460947584957):0.28499889763535835):0.1791270322913694):0.3375226540979446):0.014673163724781002):0.10602823012119544):0.10346825662582781,(((((28:0.3951313616811536):0.3884246110439735):0.1548355231716938):0.1004936129642322):0.021680292450313443,((((((44:0.07732203410424665):0.32372853571581706):0.29989858793295854):0.0647311723643027):0.12170616926081945):0.05698372615466529,((((10:0.21100802668854302,70:0.21100802668854302):0.34695513964406555):0.25371274627662044,(53:0.6457470832204486):0.1659288293887804):0.11765267690171721):0.01504163602186348):0.11619517577855687):0.004387442660959584):0.08042796513588746):0.005344785908267813):0.03579227956515596):0.016038392289589698):0.10702577115886203):0.19699390820301155):0.13443669613829445):0.03583273364763073,(((((((18:0.008745783438392607):0.0346849214713818,93:0.04343070490977441):0.2166861390994037):0.629254581686324):0.3868382379538642):0.1505323157414149,(((((((60:0.2814908996940111):0.05568228416389598):0.5705219240408907):0.20073068790473103):0.04474427874441411):0.17429198399099954):0.07843885990994615):0.02084106094189253):0.1775531818809748):0.07255021474726986):0.23484507995615922):0.1565052829061131,(((((((((85:0.2836112687761534):0.01782696440852849):0.0672297069232104):0.21689806720239635):9.859962522451582E-5):0.1867452643800538,(((2:0.07463738743032255,22:0.07463738743032255):0.3750026945181548):0.008778745454937287):0.31399104391215227):0.8088471308087863):0.11612003829088668,(((((((((((3:0.1626887650299671):0.24798994494668003):0.08796827653686545):0.08289888859193906):0.08267020430911498):0.10147140580106928):0.12801866552207763):0.06831216256328698):0.09596110427041737):0.0763897647179197):0.3311781239454532,(((((((((95:0.6674568508058416):0.21245197206351474):0.026924286524729668):0.06887362696177357):0.03290265210170795):0.2812539220150916,((((((((((42:0.40448780376855664):0.1589666499413105):0.034609591534021655):0.3279239423525544):0.007893348990195781):0.092422219730661):0.035292908387997146):0.07468597529227772,((((((73:0.07076058964647514):0.21414114144085605):0.38482005694835086):0.05005223807170456):0.20790767174938307):0.10046795695630761,((((61:0.020434779694522565):0.6743911252862524):0.19992829117104494):0.07957332631330982):0.05382213234794753):0.10813278518449754):0.01609087084087868,((63:0.025400280250206908):0.40400983655545586):0.7229631940327907):0.12421314506710956,(((((((((((45:0.05822482764960091):0.4364350336815934,(35:0.29958644524963063):0.1950734160815637):0.24431708492186632):0.03997708058949012):0.04963715084153453):0.0214569641504454):0.11094430297978453):0.13813436408508584):0.023205353211795066,(((((39:0.06423486056776584):0.551489699200048):0.10455348431285838):0.11307470873597825):0.17492402576760946):0.11405538352693623):0.005154751165386218):0.13122777215302261):0.017871770475958115):0.013276854567096041):0.09255231750765325):0.03658295955345214,((((((((100:0.114182440439905,1:0.114182440439905):0.4751376467682644):0.08688083410997272):0.20824148224705996):0.09454371223921032):0.025434963872074112):0.18045820973938076):0.07156069146227217):0.16255860665562505):0.03990426993392382):0.006644448767102462):0.23182973418044917):0.05432609977817593):0.31649259868788227):0.05514763581814014):0.10705313422705925):0.0030315770852450963);";
        tips[1]=100;

        // all 245 tips
        trees[2] = "((((((((((((((((147:0.32093540208008164):0.060975097233229025):0.31368621184700474,203:0.6955967111603154):0.14021726278152546,(196:0.27101115063869985):0.564802823303141):0.2371408222226441,(((146:0.17505352308852729):0.18167460916445455,(173:0.11114029483538612,80:0.11114029483538612):0.2455878374175957):0.5410016457715399):0.17522501813996327):0.096868837962653,((((((158:0.3735191185528217,243:0.3735191185528217):0.1068048058337232):0.12547132425603613):0.04179762442977131):0.11822583863618519,((2:0.3886510272331738,167:0.3886510272331738):0.09381552317562081):0.28335216129974294):0.08685215563597892,(((((169:0.24682061936594568,26:0.24682061936594568):0.06032592373220158):0.10259288458356641):0.1324511391480958):0.030809848687532115):0.27967045182717487):0.3171527667826215):0.14657273838145435,(((((((97:0.7488343242699871):0.16948548914457118):0.03807154346680708):0.04341962335684402):0.15250817917904214):0.09298056728028814):0.0551689663259427):0.01592767948510998):0.10072403145482123):0.050678655520220994,(((((((((174:0.4665838346756783):0.20376561215729594):0.06004111503509724):0.014002670903123793):0.058165228976054806):0.03756791495018619):0.010135769548953233,(((164:0.2218914614395655,6:0.2218914614395655):0.1875283161639416,(((137:0.0143421338853984,221:0.0143421338853984):0.20785957338897454):0.0432996041810334,24:0.26550131145540634):0.14391846614810078):0.37081619845199465):0.07002617019088775):0.15339239567885343):0.2918517026058338):0.17229281495255777):0.07507504401318077,((((((57:0.21804866081771657,128:0.21804866081771657):0.5361582614105012):0.22336535488684883):0.009378241491858175):0.2519526315593583):0.16261255597130897):0.1413583973592233):0.10524927559301678,((((((((186:0.1860500785885586):0.3714808033739496,218:0.5575308819625082):0.05751608996370239):0.00139645605243377):0.10281120115470532):0.12469517192360757):0.18965902688866731):0.07768108455947198):0.5368334665847355):0.08457795190226658,(((((((((((((184:0.25823318903568193,232:0.25823318903568193):0.023264552441336406):0.34297230561704617):0.21927238062747878):0.044354661729561595,(198:0.7720204711856191):0.11607661826548576):0.002436661133942586):0.0010926103408055443,(((((((75:0.20741715038729058,170:0.20741715038729058):0.18443102512754628,29:0.39184817551483686):0.0032976040457390887,(34:0.23283126437516266,37:0.23283126437516266):0.1623145151854133):0.011369160272506118,31:0.40651493983308207):0.14944144440231688,(223:0.17364024731248184):0.3823161369229171):0.10880606135230275):0.16758150566960417):0.05928240966854714):0.16391086024258117):0.011701488700661233):0.14092214455054553,(((228:0.19087344614669055):0.425467926733315):0.4937535930432544):0.09806588849638098):0.2340707890410838):0.12772012077627393,((((((((((((96:0.034945690780505245,197:0.034945690780505245):0.18690575707525925):0.0055238654678793075,239:0.2273753133236438):0.17549828083562113,((((144:0.02493672768545574,188:0.02493672768545574):0.14923286629530885,(226:2.861517250267731E-4,204:2.861517250267731E-4):0.17388344225573782):0.04404101036417485):0.15589287167847088,(((190:0.15746031863846044):0.0643871128273461,(233:0.050408750672636504,112:0.050408750672636504):0.17143868079317004):0.04446747285853103):0.10778857169907274):0.028770118135854617):0.052657424686713306):0.18077778257914145,((187:0.38477362757472466):0.04431931356343455):0.20721586028696048):0.17231167188120433):0.028148104791981376):0.08759048376207579,((((104:0.03219949787489451,86:0.03219949787489451):0.17503222233260063,(45:0.017591236215728223,94:0.017591236215728223):0.18964048399176692):0.040289566553747935,111:0.24752128676124308):0.3467870959051167):0.3300506791940214):0.355313383051572,(((((((236:0.7349319294995935):0.1060610571868732):0.03944006506998865):0.0775329193305736):0.014186811376566189):0.2636542986745669):0.002114508379411406):0.04175085539437973):0.010792873641607192):0.14244055560279056):0.13704589008064771):0.042956592966824636):0.11979297378827536):0.1616741410359196,(((((35:0.5782526393646168):0.012970052188087111):0.5177675311410874):0.36692596807395095):0.04523519093679418,(((((((((211:0.36616875213493794):0.07379050553556743):0.09240672376110304):0.11000994027865496,((((121:0.3322929367219407,159:0.3322929367219407):0.16814303430936084):0.01463948010138183,10:0.5150754511326834):0.08334241785633001):0.043958052721249974):0.07793440141201247):0.014375082143032625):0.16257487491722755):0.4802322834943573,((((219:0.3862334779611709,114:0.3862334779611709):0.5225168133863125,(((160:0.0995536332436231,127:0.0995536332436231):0.2285668994570642):0.039843003336478056):0.5407867553103181):0.2082129450653578):0.17238223627645688):0.08814709098759521):0.006527587862507511):0.13713123016513562):0.3732240903234818):0.22896790267142003,(((((((((((((((42:0.4241004269162314,161:0.4241004269162314):0.04886338982182892):0.04897812286788539,((59:0.04626858886278473,30:0.04626858886278473):0.3274362112137248,207:0.3737048000765095):0.14823713952943618):0.5175644010452773,((69:0.5041606259847677):0.3168991851485383):0.218446529517917):0.026114645996676566,(((154:0.1946664410900527,74:0.1946664410900527):0.2158928831153264,(152:0.4015975230947868):0.008961801110592305):0.41494843548179894,(((((107:0.3766584818090162):0.2857836812525454,((88:0.3736316787398084,200:0.3736316787398084):0.25155926244500626):0.0372512218767469):0.009564035857723363):0.0063664663943663324,101:0.6783726653136513):0.01326105604036254):0.13387403833316425):0.24011322696072157):0.031243061705280573,((((138:0.4386622228093717):0.3323117553957604):0.04618996646483775):0.239835195997115):0.0398649076860953):0.0947324717274971):0.269069516608895,(((((((((((((79:0.11211745172100596,212:0.11211745172100596):0.05319121815408856):0.005293611760161632):0.10301883598780703,82:0.2736211176230632):0.18666824042432584):0.014771496517346439):0.07462525517953744):0.18679109191585264,235:0.7364772016601255):0.1387364300124001):0.0739889944819303):0.0639896908972466):0.04250068534935325):0.3508980837148803,(((((((((185:0.2925293030227234):0.1562216561670433,230:0.4487509591897667):0.04881259516803205):0.18632855798023318,(((((180:0.10502877924887644):0.12942839642979465,((155:0.056331038895975016,53:0.056331038895975016):0.12404803586902835,(115:0.10310711691621854,47:0.10310711691621854):0.07727195784878482):0.054078100913667715):0.027281350236161295,242:0.2617385259148324):0.2266784992072739,(((72:0.05571036530712714,44:0.05571036530712714):0.12217386013969955,87:0.1778842254468267):0.061749174821942976,224:0.23963340026876967):0.2487836248533366):0.024949902744727526,((78:0.3232306519751287,108:0.3232306519751287):0.07811221568637183):0.11202406020533329):0.17052518447119813):0.3343521546993391):0.14078718006501556):0.07871842204764423):0.10331217049307906):0.02544618387418285,(((((((((((((((237:0.2583299982576541):0.22951007825704028):0.18369731654048382):0.16691282620794):0.020850345304575413):0.015937366433874223):0.01411639985387092):0.06279173930680826):0.10962686599668547,((((((90:0.2811005327299019):0.0887445358621961,(93:0.3533501535020718):0.016494915090026208):0.16098762139325107):0.19483207805907932):0.022828470516035537):0.1818843615121788):0.13139533608628984):0.06500744366185152,(((((61:0.021546584301352034,46:0.021546584301352034):0.344142745051379,70:0.365689329352731):0.08940911502227822,(157:0.06065352159978854,213:0.06065352159978854):0.3944449227752207):0.4448553189892812,((((199:0.17317170680705862,33:0.17317170680705862):0.08454901978202889):0.5197085655621292):0.026036736565057117):0.09648773464801663):0.12099209756631146,(((((116:0.26736825607667125):0.04783629408263801):0.003256855981669027):0.3357064188081358,((205:0.47080767479562846):0.14051526189731378,((113:0.22557136133512268):0.2073587081558772):0.17839286720194236):0.04284488825617183):0.307507747966552,((((((133:0.18571664984559622,39:0.18571664984559622):0.17867471364482457,((135:0.0658969433606229,119:0.0658969433606229):0.22743321045677778):0.0710612096730201):0.329092908827072):0.04555841519489978):0.12628732463694536,(((192:0.7601879802148701):0.026963297231470618):0.06068862113203921):0.017490113570957977):0.025588099317396917):0.07075746144893125):0.059270288014935835):0.10583451889018214):0.0030242958278119403):0.015465737556799475):0.10320741178706783,((((((103:0.24626376861760324,89:0.24626376861760324):0.12744868322911307):0.07466468208771193,(206:0.2759212994177287,71:0.2759212994177287):0.17245583451669955):0.10824029983607808,(62:0.3091827356676293):0.247434698102877):0.0809251028563962):0.49155171365805117,(((((64:0.5319160810446424):0.059550006859657945):0.2586346015866312):0.01758373547152714,(((130:0.048359004317534815,3:0.048359004317534815):0.44896214257134437):0.07522974332834287):0.2951335347452366):0.03144437451077775,((((((((129:0.02217996438076053,231:0.02217996438076053):0.20079958631531447,244:0.222979550696075):0.2946752848818519):0.012656799000299701,58:0.5303116345782266):0.019679586316499353,50:0.549991220894726):0.025029094913389782):0.07522493457638535,153:0.6502452503845011):0.08861795875904366):0.16026559032969168):0.22996545081171726):0.1193835747075096):0.008850564382922643):0.04501758695019498):0.06416224719171182):0.040082862598643354):0.054074950573636205):0.0074844678674776954,(((((201:0.20357841368630236,166:0.20357841368630236):0.3434955641646298,(((141:0.012266430667138728,122:0.012266430667138728):0.5260017224092914):0.00239774103653545):0.00640808373796653):0.7625820889503805,(((((17:0.929531119006056):0.013901918035597038,(((((171:0.07242909393280295,105:0.07242909393280295):0.23479701936494912,8:0.30722611329775207):0.11523249249406309,214:0.42245860579181516):0.14850950427796006):0.29589919873956205):0.07656572823231578):0.023237353600260358):0.06386482739098565):0.24070979484081634,(((((81:0.5348631098745043):0.11637661069513672):0.3412667862870975):0.034246836978997):0.08688807903336637):0.15760359000461355):0.03841105392759725):0.0033997287112403907,(((((((68:0.02789630554792666,67:0.02789630554792666):0.10076698096962167,194:0.12866328651754833):0.4402161678399219):0.08150727206094377):0.10347433302491194):0.18514800536999498,(((124:0.05467586259720836,55:0.05467586259720836):0.6502890380379189):0.0996766613138651,((43:0.5270497024277359):0.23856211230281055,((76:0.5435674940506248):0.04143818622863926,((222:0.14637338168470126):0.4314734671151026):0.00715883147946017):0.18060613445128237):0.03902974721844599):0.13436750286432853):0.35330057839489504):0.020746152304337073):0.08288253594316153):0.07221217310133543):0.011586884164399347):0.026838557511651318,((((((((((131:0.46907201670194976):0.14114594598201302):0.14270389478931533):0.02353714022280573):0.1912724922352007,(((((36:0.011349922960334435,14:0.011349922960334435):0.1833596050516615):0.1008916069157082,(209:0.11182495242383439,240:0.11182495242383439):0.18377618250386973):0.09496216216272835):0.21798333319191565,((51:0.0035453008061563374,229:0.0035453008061563374):0.5728941509819325):0.03210717849425926):0.3591848596489364):0.006808677675159691):0.05209742884029245):0.1690511914287287):0.006867478995761456,((((((((49:0.22758379023380604,178:0.22758379023380604):0.42133647875555336):0.020351918918371403,(((91:0.11073058060257779):0.2215470617281734,27:0.3322776423307512):0.14240197672737986,((60:0.18721514171821152,21:0.18721514171821152):0.06417088823374106,((65:0.15128689471622314,95:0.15128689471622314):0.0067865726840588,5:0.15807346740028194):0.09331256255167064):0.22329358910617847):0.19459256884959975):0.0010930897008205598,((((((234:0.13697614690031212,99:0.13697614690031212):0.1212878255135239):0.03435121850887368,((7:0.10231532304161384,20:0.10231532304161384):0.0516554105874496):0.13864445729364627):0.18149349857988994,((123:0.1139493765116022):0.07439959109231786,172:0.18834896760392006):0.2857597218986796):0.003475660991485885,(((139:0.07492552776593131,98:0.07492552776593131):0.24780331920546006):0.1535526813866661):0.001302822136028059):0.05115386060759386,((132:0.24055708552318356):0.11308705432167487,142:0.35364413984485843):0.17509407125682097):0.14162706650687196):0.26770654920188974):0.11390806361005201,((((((238:0.37053873818867133):0.03917307550600313):0.01863477310621553):0.055451223928164595):0.234130862004567):0.2947007272612927):0.03935049042557881):0.09874570459598808,(((((202:0.4665626978637163):0.48419729724508365,((((((((177:0.004259389439384087,140:0.004259389439384087):0.06344738090632385,215:0.06770677034570793):0.2815523935976807):0.2337381956013651):0.07646012161597993):0.004243017666983651):0.13970436378605466):0.04038042079290327):0.10697471170212469):0.03552944118151302):0.10222983110145667):0.05686154171644375,((((((145:0.28341346497475284):0.19128884417966763,162:0.47470230915442047):0.16424582016417655,(((40:0.22392905261685803,16:0.22392905261685803):0.06077910259057928):0.3302026166046108,(((149:0.0791638720399086,156:0.0791638720399086):0.039560932068283705,225:0.1187248041081923):0.28923515555720103,179:0.40795995966539333):0.20695081214665478):0.024037357506548895):0.23532349664389995,(((163:0.0015754429076402232,125:0.0015754429076402232):0.24118348050045535,18:0.24275892340809557):0.35817195904686927):0.2733407435075321):0.08721296138400114,((((((220:0.0304985617330793,110:0.0304985617330793):0.00863604774277027,106:0.03913460947584957):0.28499889763535835):0.17912703229136917):0.3375226540979446):0.014673163724781002,(((19:0.18875014968163129):0.01607204231251247,13:0.20482219199414375):0.05745086620891504):0.5931832990222439):0.10602823012119544):0.10346825662582781,(((((216:0.3951313616811536,52:0.3951313616811536):0.3884246110439733):0.1548355231716938):0.1004936129642322):0.021680292450313443,((((((((136:0.5187991715210944):0.015100556212080951):0.08647930635924905,((245:0.22423175430736375):0.15958306301743796,151:0.3838148173248017):0.23656421676762274):0.0307294654231558,117:0.6511084995155803):0.04984065823744177,((118:0.07732203410424665):0.32372853571581706):0.2998985879329583):0.0647311723643027):0.12170616926081945):0.05698372615466529,((((38:0.21100802668854302,109:0.21100802668854302):0.3469551396440653):0.25371274627662044,(32:0.6457470832204484):0.1659288293887804):0.11765267690171721):0.01504163602186348):0.11619517577855687):0.004387442660959584):0.08042796513588746):0.005344785908267813):0.03579227956515596):0.016038392289589698):0.10702577115886203):0.19699390820301177):0.13443669613829445):0.03583273364763073,(((((((63:0.008745783438392607,100:0.008745783438392607):0.0346849214713818,28:0.04343070490977441):0.2166861390994037,66:0.2601168440091781):0.6292545816863238):0.3868382379538642):0.1505323157414149,(((((((181:0.2814908996940111,208:0.2814908996940111):0.05568228416389598):0.5705219240408905):0.20073068790473103):0.04474427874441411,((((102:0.3584809217421019):0.056484176013878784,((41:0.018499592191076886,120:0.018499592191076886):0.25668984144183504,1:0.27518943363291193):0.13977566412306874):0.47067483485130546):0.20344098098620433):0.06408916095445227):0.17429198399099954):0.07843885990994615):0.02084106094189253):0.17755318188097502):0.07255021474726986):0.23484507995615922):0.1565052829061131,((((((((((4:0.2509146863780578):0.032696582398095586,165:0.2836112687761534):0.01782696440852849):0.0672297069232104,(175:0.28696340345513116):0.08170453665276112):0.21689806720239613):9.859962522451582E-5,(73:0.5819376406336494):0.0037269663018635324):0.1867452643800538,((((54:0.10983208776720721,9:0.10983208776720721):0.20167938981497846,56:0.31151147758218567):0.08956549663621338):0.05734185318501561,((84:0.07463738743032255,217:0.07463738743032255):0.3750026945181548,168:0.4496400819484774):0.008778745454937287):0.31399104391215205):0.8088471308087866):0.11612003829088668,(((((((((((195:0.1626887650299671,148:0.1626887650299671):0.24798994494668003):0.08796827653686545):0.08289888859193884):0.08267020430911498):0.10147140580106928):0.12801866552207763):0.06831216256328698):0.09596110427041737):0.0763897647179197):0.33117812394545343,(((((((((48:0.6674568508058414):0.21245197206351474):0.026924286524729668):0.06887362696177357):0.03290265210170795,(((15:0.8228157343934843):0.1306012800581311):0.004723537712539638,(25:0.7225309636477493):0.2356095885164058):0.050468836293412256):0.2812539220150916,((((((((((176:0.40448780376855664):0.15896664994131027):0.034609591534021655,77:0.5980640452438886):0.3279239423525544):0.007893348990195781):0.092422219730661,193:1.0263035563172997):0.035292908387997146):0.07468597529227772,((((((12:0.07076058964647514,92:0.07076058964647514):0.21414114144085605,23:0.2849017310873312):0.38482005694835064,189:0.6697217880356818):0.05005223807170456):0.20790767174938307):0.10046795695630761,((((134:0.020434779694522565):0.6743911252862522):0.19992829117104494):0.07957332631330982):0.05382213234794753):0.10813278518449754):0.01609087084087868,((85:0.025400280250206908,182:0.025400280250206908):0.40400983655545586):0.7229631940327905):0.12421314506710956,(((((((((((241:0.05822482764960091):0.4364350336815934,(11:0.29958644524963063):0.1950734160815637):0.2443170849218661):0.03997708058949012,126:0.7789540268425506):0.04963715084153453):0.0214569641504454):0.11094430297978453):0.13813436408508584):0.023205353211795066,((((150:0.6575863146834671):0.06269172939720491,((227:0.06423486056776584,210:0.06423486056776584):0.5514896992000478):0.10455348431285838):0.11307470873597825):0.17492402576760946):0.11405538352693623):0.005154751165386218):0.13122777215302261):0.017871770475958115):0.013276854567096041):0.09255231750765325):0.03658295955345214,((((((((22:0.114182440439905,191:0.114182440439905):0.4751376467682642):0.08688083410997272):0.20824148224705996):0.09454371223921032,143:0.9789861158044122):0.025434963872074112):0.18045820973938076):0.07156069146227217):0.16255860665562505):0.03990426993392382,(((((183:0.11405807111030786):0.3588705661923077):0.44758369155829625,((83:0.4323823137566718):0.3230076651853868):0.16512234991885322):0.36393986807653356):0.15036695905451558):0.024083701475727137):0.006644448767102684):0.23182973418044917):0.05432609977817593):0.31649259868788227):0.05514763581814014):0.10705313422705925):0.0030315770852450963);";
        tips[2] = 245;

        Tree tree ;

        double logLvc ;

        for (int j=0;j<trees.length;j++){
//        for (int j=0;j<1;j++){


            writer = new PrintWriter(new FileWriter("/Users/Denise/Documents/Projects/BDSIR/coalComp/vary_gamma_"+ j +".txt"));
            writer.println("#tree = " + trees[j]);
            writer.println("#tips = " + tips[j]);

            tree = new TreeParser(trees[j],false);

            TreeIntervals treeIntervals = new TreeIntervals();
            treeIntervals.init(tree);

            double step = (upper - lower) / (steps);

            Volz2009Coalescent vc;
            VolzSIR vvc;
            Coalescent coal;
            BDSIR bdsir;

            Double current;

            Double beta = 0.005;
//            Double death = 2.;
            Double origin = 2.5;
            double S0 = 1000;

            writer.println("gamma\tvolzSIR\tvolz2009\tBDSIR");

            for (int i=1; i<=steps; i++){

                current = lower + i*step;

//            writer.println("beta = " + current);
                writer.print(current + "\t");

                vc =  new Volz2009Coalescent();
                vc.setInputValue("treeIntervals", new TreeIntervals(tree));
                vc.setInputValue("beta", new RealParameter(new Double[]{beta}));
                vc.setInputValue("delta", new RealParameter(new Double[]{current}));
                vc.setInputValue("S0", new RealParameter(new Double[]{S0}));
                vc.setInputValue("T", new RealParameter("2.5"));

                try{

                    vc.initAndValidate();
                    logLvc =  vc.calculateLogP();

                }catch(Exception e){
                    logLvc = Double.NaN;
                }

                vvc = new VolzSIR();
                vvc.setInputValue("beta", new RealParameter(new Double[]{beta}));
                vvc.setInputValue("gamma", new RealParameter(new Double[]{current}));
                vvc.setInputValue("n_S0", new RealParameter(new Double[]{S0}));
                vvc.setInputValue("origin", new RealParameter("2.5"));
                vvc.setInputValue("integrationStepCount", 1000);

                vvc.initAndValidate();

                HybridSEIREpidemic sir = new HybridSEIREpidemic();
                sir.initByName(
                        "tree", tree,
                        "birth", new RealParameter(new Double[]{beta}),
                        "death",new RealParameter(new Double[]{current}),
                        "sampling", "0",
                        "origin", new RealParameter("2.5"),
                        "S0", new RealParameter(new Double[]{1000.}),
                        "Nt", "10001",
                        "Nsamples", "101" ,
                        "simulationType", "SAL"
                    ,"isDeterministic", "true"
                );

                sir.initTraj(beta, 0., new Double[]{current}, new Double[]{0.}, origin, tree.getLeafNodeCount(), 100, 1000, sir.times);


                bdsir = new BDSIR();
                bdsir.setInputValue("tree", tree);
                bdsir.setInputValue("birthRate", new RealParameter(new Double[]{beta*S0}));
                bdsir.setInputValue("deathRate", new RealParameter(new Double[]{current}));
                bdsir.setInputValue("samplingRate", new RealParameter("0"));
                bdsir.setInputValue("rho", new RealParameter(new Double[]{tips[j]/245.}));
                bdsir.setInputValue("S0", new RealParameter(new Double[]{S0}));
                bdsir.setInputValue("origin", new RealParameter("2.5"));
                bdsir.setInputValue("dS", new RealParameter(sir.get_dS()));
                bdsir.setInputValue("dR", new RealParameter(sir.get_dR()));
                bdsir.setInputValue("checkTreeConsistent", false);

                bdsir.initAndValidate();

                coal = new Coalescent();
                coal.initByName("treeIntervals", treeIntervals, "populationModel", vvc);


                double logLvvc =  coal.calculateLogP();
//            writer.println("volzSIR (Tim)  logL = " + logLvvc);
                writer.print((Double.isInfinite(logLvvc)?"NA":logLvvc) + "\t");


//            writer.println("volz2009coalescent logL = " + logLvc);
                writer.print((Double.isInfinite(logLvc)?"NA":logLvc) + "\t");

                double logLbdsir =  bdsir.calculateTreeLogLikelihood(tree);
//            writer.println("bdsir logL = " + logLbdsir);
                writer.println((Double.isInfinite(logLbdsir)?"NA":logLbdsir) + "\t");

                //        assertEquals(-19.0198, vc.calculateLogP(), 1e-5);
//            assertEquals(logLvvc, logLvc, 1e-5);



            }
            writer.flush();
            writer.close();

        }
    }

    @Test
    public void testCompareS0() throws Exception{

        PrintWriter writer;

        double lower = 100;
        double upper = 2000;
        int steps = 100;

        String[] trees = new String[3];

        int[] tips = new int[trees.length] ;
        //25 tips
        trees[0] = "((((((((((((((((7:0.0143421338853984):0.20785957338897454):0.0432996041810334):0.14391846614810078):0.37081619845199487):0.07002617019088775):0.15339239567885343):0.2918517026058338):0.17229281495255755):0.07507504401318077):0.10524927559301678):0.08457795190226658,((((((((((8:0.7720204711856193):0.11607661826548576):0.002436661133942586):0.0010926103408055443):0.16391086024258117):0.011701488700661233):0.14092214455054553):0.2340707890410838):0.1277201207762737,(((((((((((((24:2.861517250267731E-4):0.17388344225573782):0.04404101036417485):0.15589287167847088):0.028770118135854617):0.052657424686713306):0.18077778257914168):0.17231167188120433):0.028148104791981376):0.08759048376207579):0.355313383051572):0.010792873641607192):0.14244055560279056):0.1370458900806475):0.042956592966824636):0.11979297378827536):0.1616741410359196):0.22896790267142003,((((((((((((((((((3:0.3736316787398084):0.2515592624450065):0.0372512218767469):0.009564035857723363):0.0063664663943663324):0.01326105604036254):0.13387403833316425):0.24011322696072157):0.031243061705280573):0.0947324717274971):0.2690695166088948,(((((((((((((5:0.11211745172100596):0.05319121815408856):0.005293611760161632):0.10301883598780703):0.18666824042432584):0.014771496517346439):0.07462525517953766):0.18679109191585264,1:0.7364772016601258):0.1387364300124001):0.0739889944819303):0.0639896908972466):0.04250068534935325):0.3508980837148803,((((((((((((6:0.056331038895975016):0.12404803586902835):0.054078100913667715):0.027281350236161295):0.2266784992072739):0.024949902744727748):0.17052518447119813):0.3343521546993391):0.14078718006501556):0.07871842204764423):0.10331217049307906):0.02544618387418285,((((((((((((10:0.17317170680705862):0.08454901978202889):0.5197085655621294):0.026036736565057117):0.09648773464801663):0.12099209756631146,(((((((22:0.18571664984559622):0.17867471364482457):0.3290929088270722):0.04555841519489978):0.12628732463694536,(((15:0.7601879802148703):0.026963297231470618):0.06068862113203921):0.017490113570957977):0.025588099317396917):0.07075746144893125):0.059270288014935835):0.10583451889018214):0.0030242958278119403):0.015465737556799475):0.10320741178706783,((((((20:0.24626376861760324):0.12744868322911307):0.07466468208771193):0.1082402998360783):0.0809251028563962):0.49155171365805117,(((((14:0.048359004317534815):0.44896214257134437):0.07522974332834309):0.2951335347452366):0.03144437451077775):0.22996545081171726):0.1193835747075096):0.008850564382922643):0.04501758695019498):0.06416224719171182):0.040082862598643354):0.05407495057363598):0.0074844678674776954,(((((((25:0.012266430667138728,9:0.012266430667138728):0.5260017224092917):0.00239774103653545):0.00640808373796653):0.7625820889503805):0.0033997287112403907,((((((18:0.12866328651754833):0.4402161678399221):0.08150727206094377):0.10347433302491194):0.18514800536999498,(((((2:0.14637338168470126):0.4314734671151028):0.00715883147946017):0.18060613445128237):0.03902974721844599):0.13436750286432853):0.35330057839489504):0.020746152304337073):0.08288253594316153):0.07221217310133521):0.011586884164399347):0.026838557511651318,(((((((((((((16:0.13697614690031212):0.1212878255135239):0.03435121850887368):0.18149349857988994):0.003475660991485885):0.05115386060759408,(12:0.35364413984485843):0.1750940712568212):0.14162706650687196):0.26770654920188974):0.11390806361005201):0.09874570459598808,(((((((23:0.6457470832204486):0.1659288293887804):0.11765267690171721):0.01504163602186348):0.11619517577855687):0.004387442660959584):0.08042796513588746):0.005344785908267813):0.03579227956515596):0.016038392289589698):0.10702577115886203):0.19699390820301155):0.13443669613829445):0.03583273364763073,(((((((4:0.008745783438392607):0.0346849214713818):0.2166861390994037):0.629254581686324):0.3868382379538642):0.1505323157414149):0.1775531818809748):0.07255021474726986):0.23484507995615922):0.1565052829061131,(((((((((17:0.2836112687761534):0.01782696440852849):0.0672297069232104):0.21689806720239635):9.859962522451582E-5):0.1867452643800538,(((13:0.07463738743032255,21:0.07463738743032255):0.3750026945181548):0.008778745454937287):0.31399104391215227):0.8088471308087863):0.11612003829088668,(((((((((((((11:0.020434779694522565):0.6743911252862524):0.19992829117104494):0.07957332631330982):0.05382213234794753):0.10813278518449754):0.01609087084087868):0.12421314506710956,(((((((((((19:0.05822482764960091):0.4364350336815934):0.24431708492186632):0.03997708058949012):0.04963715084153453):0.0214569641504454):0.11094430297978453):0.13813436408508584):0.023205353211795066):0.005154751165386218):0.13122777215302261):0.017871770475958115):0.013276854567096041):0.09255231750765325):0.03658295955345214):0.03990426993392382):0.006644448767102462):0.23182973418044917):0.05432609977817593):0.31649259868788227):0.05514763581814014):0.10705313422705925):0.0030315770852450963);";
        tips[0] = 25;

        //100 tips
        trees[1] = "((((((((((((((((13:0.32093540208008164):0.060975097233229025):0.31368621184700496):0.14021726278152546):0.2371408222226441,(((31:0.11114029483538612):0.2455878374175957):0.5410016457715401):0.17522501813996327):0.096868837962653,((((99:0.3886510272331738):0.09381552317562081):0.28335216129974317):0.08685215563597892):0.3171527667826215):0.14657273838145435):0.10072403145482123):0.05067865552022077,((((((37:0.2218914614395655):0.1875283161639416,(((72:0.0143421338853984):0.20785957338897454):0.0432996041810334,34:0.26550131145540634):0.14391846614810078):0.37081619845199487):0.07002617019088775):0.15339239567885343):0.2918517026058338):0.17229281495255755):0.07507504401318077):0.10524927559301678,((((((((86:0.1860500785885586):0.37148080337394984):0.05751608996370239):0.00139645605243377):0.10281120115470532):0.12469517192360757):0.18965902688866731):0.07768108455947198):0.5368334665847353):0.08457795190226658,((((((((((52:0.7720204711856193):0.11607661826548576):0.002436661133942586):0.0010926103408055443,((((((47:0.23283126437516266):0.1623145151854133):0.011369160272506118):0.1494414444023171,(24:0.17364024731248184):0.3823161369229173):0.10880606135230275):0.16758150566960417):0.05928240966854714):0.16391086024258117):0.011701488700661233):0.14092214455054553):0.2340707890410838):0.1277201207762737,((((((((((((15:0.034945690780505245,19:0.034945690780505245):0.18690575707525925):0.0055238654678793075,21:0.2273753133236438):0.17549828083562113,((((17:0.02493672768545574):0.14923286629530885,(76:2.861517250267731E-4):0.17388344225573782):0.04404101036417485):0.15589287167847088,(((82:0.050408750672636504,67:0.050408750672636504):0.17143868079317004):0.04446747285853103):0.10778857169907274):0.028770118135854617):0.052657424686713306):0.18077778257914168,((51:0.38477362757472466):0.04431931356343455):0.2072158602869607):0.17231167188120433):0.028148104791981376):0.08759048376207579,((((94:0.017591236215728223):0.18964048399176692):0.040289566553747935,6:0.24752128676124308):0.3467870959051169):0.3300506791940214):0.355313383051572):0.010792873641607192):0.14244055560279056):0.1370458900806475):0.042956592966824636):0.11979297378827536):0.1616741410359196,((((((((((40:0.36616875213493794):0.07379050553556743):0.09240672376110326):0.11000994027865496):0.07793440141201247):0.014375082143032625):0.16257487491722755):0.4802322834943573):0.006527587862507511):0.1371312301651354):0.3732240903234818):0.22896790267142003,(((((((((((((((80:0.4241004269162314):0.04886338982182892):0.04897812286788561,(57:0.3737048000765095):0.1482371395294364):0.5175644010452773):0.026114645996676566,(((41:0.1946664410900527):0.2158928831153264):0.41494843548179916,((((((87:0.3736316787398084):0.2515592624450065):0.0372512218767469):0.009564035857723363):0.0063664663943663324,83:0.6783726653136515):0.01326105604036254):0.13387403833316425):0.24011322696072157):0.031243061705280573):0.0947324717274971):0.2690695166088948,(((((((((((((36:0.11211745172100596):0.05319121815408856):0.005293611760161632):0.10301883598780703):0.18666824042432584):0.014771496517346439):0.07462525517953766):0.18679109191585264,75:0.7364772016601258):0.1387364300124001):0.0739889944819303):0.0639896908972466):0.04250068534935325):0.3508980837148803,(((((((((56:0.2925293030227234):0.1562216561670433):0.04881259516803205):0.1863285579802334,((((((26:0.056331038895975016,66:0.056331038895975016):0.12404803586902835):0.054078100913667715):0.027281350236161295,81:0.2617385259148324):0.2266784992072739,(((89:0.05571036530712714):0.12217386013969955):0.061749174821942976):0.2487836248533366):0.024949902744727748,((20:0.3232306519751287):0.07811221568637183):0.11202406020533351):0.17052518447119813):0.3343521546993391):0.14078718006501556):0.07871842204764423):0.10331217049307906):0.02544618387418285,(((((((((((((((68:0.2583299982576541):0.22951007825704028):0.18369731654048405):0.16691282620794):0.020850345304575413):0.015937366433874223):0.01411639985387092):0.06279173930680826):0.10962686599668547,((((((96:0.2811005327299019):0.0887445358621961):0.1609876213932513):0.19483207805907932):0.022828470516035537):0.1818843615121788):0.13139533608628984):0.06500744366185152,(((((11:0.021546584301352034):0.344142745051379):0.08940911502227822):0.44485531898928143,((((5:0.17317170680705862,74:0.17317170680705862):0.08454901978202889):0.5197085655621294):0.026036736565057117):0.09648773464801663):0.12099209756631146,(((((90:0.26736825607667125):0.04783629408263801):0.003256855981669027):0.335706418808136,(((12:0.22557136133512268):0.2073587081558772):0.17839286720194258):0.04284488825617183):0.307507747966552,((((((98:0.18571664984559622,23:0.18571664984559622):0.17867471364482457):0.3290929088270722):0.04555841519489978):0.12628732463694536,(((14:0.7601879802148703):0.026963297231470618):0.06068862113203921):0.017490113570957977):0.025588099317396917):0.07075746144893125):0.059270288014935835):0.10583451889018214):0.0030242958278119403):0.015465737556799475):0.10320741178706783,((((((32:0.24626376861760324,16:0.24626376861760324):0.12744868322911307):0.07466468208771193):0.1082402998360783,(64:0.3091827356676293):0.24743469810287722):0.0809251028563962):0.49155171365805117,(((((43:0.048359004317534815,8:0.048359004317534815):0.44896214257134437):0.07522974332834309):0.2951335347452366):0.03144437451077775,(((((((48:0.222979550696075):0.29467528488185213):0.012656799000299701):0.019679586316499353,7:0.5499912208947262):0.025029094913389782):0.07522493457638535):0.08861795875904366):0.16026559032969168):0.22996545081171726):0.1193835747075096):0.008850564382922643):0.04501758695019498):0.06416224719171182):0.040082862598643354):0.05407495057363598):0.0074844678674776954,(((((78:0.20357841368630236):0.34349556416463,(((59:0.012266430667138728,55:0.012266430667138728):0.5260017224092917):0.00239774103653545):0.00640808373796653):0.7625820889503805,(((((71:0.9295311190060562):0.013901918035597038,(((((4:0.07242909393280295):0.23479701936494912,49:0.30722611329775207):0.11523249249406309):0.14850950427796028):0.29589919873956205):0.07656572823231578):0.023237353600260358):0.06386482739098565):0.24070979484081634,(((((69:0.5348631098745045):0.11637661069513672):0.3412667862870975):0.034246836978997):0.08688807903336637):0.15760359000461355):0.03841105392759725):0.0033997287112403907,(((((((54:0.02789630554792666):0.10076698096962167,88:0.12866328651754833):0.4402161678399221):0.08150727206094377):0.10347433302491194):0.18514800536999498,(((38:0.5270497024277361):0.23856211230281055,((84:0.543567494050625):0.04143818622863926,((30:0.14637338168470126):0.4314734671151028):0.00715883147946017):0.18060613445128237):0.03902974721844599):0.13436750286432853):0.35330057839489504):0.020746152304337073):0.08288253594316153):0.07221217310133521):0.011586884164399347):0.026838557511651318,((((((((((9:0.46907201670194976):0.14114594598201324):0.14270389478931533):0.02353714022280573):0.1912724922352007,((((29:0.11182495242383439):0.18377618250386973):0.09496216216272835):0.21798333319191587):0.3591848596489364):0.006808677675159691):0.05209742884029245):0.1690511914287287):0.006867478995761456,((((((((91:0.22758379023380604):0.4213364787555536):0.020351918918371403,((27:0.3322776423307512):0.14240197672737986,(((97:0.15128689471622314):0.0067865726840588,46:0.15807346740028194):0.09331256255167064):0.22329358910617847):0.19459256884959997):0.0010930897008205598,((((((25:0.13697614690031212):0.1212878255135239):0.03435121850887368):0.18149349857988994,(58:0.18834896760392006):0.2857597218986796):0.003475660991485885,(((77:0.07492552776593131):0.24780331920546006):0.1535526813866661):0.001302822136028059):0.05115386060759408,((50:0.24055708552318356):0.11308705432167487,79:0.35364413984485843):0.1750940712568212):0.14162706650687196):0.26770654920188974):0.11390806361005201):0.09874570459598808,(((((((((92:0.0791638720399086):0.039560932068283705):0.28923515555720103):0.206950812146655):0.024037357506548895):0.23532349664389995,(((62:0.0015754429076402232):0.24118348050045535,65:0.24275892340809557):0.3581719590468695):0.2733407435075321):0.08721296138400114,(((((33:0.03913460947584957):0.28499889763535835):0.1791270322913694):0.3375226540979446):0.014673163724781002):0.10602823012119544):0.10346825662582781,(((((28:0.3951313616811536):0.3884246110439735):0.1548355231716938):0.1004936129642322):0.021680292450313443,((((((44:0.07732203410424665):0.32372853571581706):0.29989858793295854):0.0647311723643027):0.12170616926081945):0.05698372615466529,((((10:0.21100802668854302,70:0.21100802668854302):0.34695513964406555):0.25371274627662044,(53:0.6457470832204486):0.1659288293887804):0.11765267690171721):0.01504163602186348):0.11619517577855687):0.004387442660959584):0.08042796513588746):0.005344785908267813):0.03579227956515596):0.016038392289589698):0.10702577115886203):0.19699390820301155):0.13443669613829445):0.03583273364763073,(((((((18:0.008745783438392607):0.0346849214713818,93:0.04343070490977441):0.2166861390994037):0.629254581686324):0.3868382379538642):0.1505323157414149,(((((((60:0.2814908996940111):0.05568228416389598):0.5705219240408907):0.20073068790473103):0.04474427874441411):0.17429198399099954):0.07843885990994615):0.02084106094189253):0.1775531818809748):0.07255021474726986):0.23484507995615922):0.1565052829061131,(((((((((85:0.2836112687761534):0.01782696440852849):0.0672297069232104):0.21689806720239635):9.859962522451582E-5):0.1867452643800538,(((2:0.07463738743032255,22:0.07463738743032255):0.3750026945181548):0.008778745454937287):0.31399104391215227):0.8088471308087863):0.11612003829088668,(((((((((((3:0.1626887650299671):0.24798994494668003):0.08796827653686545):0.08289888859193906):0.08267020430911498):0.10147140580106928):0.12801866552207763):0.06831216256328698):0.09596110427041737):0.0763897647179197):0.3311781239454532,(((((((((95:0.6674568508058416):0.21245197206351474):0.026924286524729668):0.06887362696177357):0.03290265210170795):0.2812539220150916,((((((((((42:0.40448780376855664):0.1589666499413105):0.034609591534021655):0.3279239423525544):0.007893348990195781):0.092422219730661):0.035292908387997146):0.07468597529227772,((((((73:0.07076058964647514):0.21414114144085605):0.38482005694835086):0.05005223807170456):0.20790767174938307):0.10046795695630761,((((61:0.020434779694522565):0.6743911252862524):0.19992829117104494):0.07957332631330982):0.05382213234794753):0.10813278518449754):0.01609087084087868,((63:0.025400280250206908):0.40400983655545586):0.7229631940327907):0.12421314506710956,(((((((((((45:0.05822482764960091):0.4364350336815934,(35:0.29958644524963063):0.1950734160815637):0.24431708492186632):0.03997708058949012):0.04963715084153453):0.0214569641504454):0.11094430297978453):0.13813436408508584):0.023205353211795066,(((((39:0.06423486056776584):0.551489699200048):0.10455348431285838):0.11307470873597825):0.17492402576760946):0.11405538352693623):0.005154751165386218):0.13122777215302261):0.017871770475958115):0.013276854567096041):0.09255231750765325):0.03658295955345214,((((((((100:0.114182440439905,1:0.114182440439905):0.4751376467682644):0.08688083410997272):0.20824148224705996):0.09454371223921032):0.025434963872074112):0.18045820973938076):0.07156069146227217):0.16255860665562505):0.03990426993392382):0.006644448767102462):0.23182973418044917):0.05432609977817593):0.31649259868788227):0.05514763581814014):0.10705313422705925):0.0030315770852450963);";
        tips[1]=100;

        // all 245 tips
        trees[2] = "((((((((((((((((147:0.32093540208008164):0.060975097233229025):0.31368621184700474,203:0.6955967111603154):0.14021726278152546,(196:0.27101115063869985):0.564802823303141):0.2371408222226441,(((146:0.17505352308852729):0.18167460916445455,(173:0.11114029483538612,80:0.11114029483538612):0.2455878374175957):0.5410016457715399):0.17522501813996327):0.096868837962653,((((((158:0.3735191185528217,243:0.3735191185528217):0.1068048058337232):0.12547132425603613):0.04179762442977131):0.11822583863618519,((2:0.3886510272331738,167:0.3886510272331738):0.09381552317562081):0.28335216129974294):0.08685215563597892,(((((169:0.24682061936594568,26:0.24682061936594568):0.06032592373220158):0.10259288458356641):0.1324511391480958):0.030809848687532115):0.27967045182717487):0.3171527667826215):0.14657273838145435,(((((((97:0.7488343242699871):0.16948548914457118):0.03807154346680708):0.04341962335684402):0.15250817917904214):0.09298056728028814):0.0551689663259427):0.01592767948510998):0.10072403145482123):0.050678655520220994,(((((((((174:0.4665838346756783):0.20376561215729594):0.06004111503509724):0.014002670903123793):0.058165228976054806):0.03756791495018619):0.010135769548953233,(((164:0.2218914614395655,6:0.2218914614395655):0.1875283161639416,(((137:0.0143421338853984,221:0.0143421338853984):0.20785957338897454):0.0432996041810334,24:0.26550131145540634):0.14391846614810078):0.37081619845199465):0.07002617019088775):0.15339239567885343):0.2918517026058338):0.17229281495255777):0.07507504401318077,((((((57:0.21804866081771657,128:0.21804866081771657):0.5361582614105012):0.22336535488684883):0.009378241491858175):0.2519526315593583):0.16261255597130897):0.1413583973592233):0.10524927559301678,((((((((186:0.1860500785885586):0.3714808033739496,218:0.5575308819625082):0.05751608996370239):0.00139645605243377):0.10281120115470532):0.12469517192360757):0.18965902688866731):0.07768108455947198):0.5368334665847355):0.08457795190226658,(((((((((((((184:0.25823318903568193,232:0.25823318903568193):0.023264552441336406):0.34297230561704617):0.21927238062747878):0.044354661729561595,(198:0.7720204711856191):0.11607661826548576):0.002436661133942586):0.0010926103408055443,(((((((75:0.20741715038729058,170:0.20741715038729058):0.18443102512754628,29:0.39184817551483686):0.0032976040457390887,(34:0.23283126437516266,37:0.23283126437516266):0.1623145151854133):0.011369160272506118,31:0.40651493983308207):0.14944144440231688,(223:0.17364024731248184):0.3823161369229171):0.10880606135230275):0.16758150566960417):0.05928240966854714):0.16391086024258117):0.011701488700661233):0.14092214455054553,(((228:0.19087344614669055):0.425467926733315):0.4937535930432544):0.09806588849638098):0.2340707890410838):0.12772012077627393,((((((((((((96:0.034945690780505245,197:0.034945690780505245):0.18690575707525925):0.0055238654678793075,239:0.2273753133236438):0.17549828083562113,((((144:0.02493672768545574,188:0.02493672768545574):0.14923286629530885,(226:2.861517250267731E-4,204:2.861517250267731E-4):0.17388344225573782):0.04404101036417485):0.15589287167847088,(((190:0.15746031863846044):0.0643871128273461,(233:0.050408750672636504,112:0.050408750672636504):0.17143868079317004):0.04446747285853103):0.10778857169907274):0.028770118135854617):0.052657424686713306):0.18077778257914145,((187:0.38477362757472466):0.04431931356343455):0.20721586028696048):0.17231167188120433):0.028148104791981376):0.08759048376207579,((((104:0.03219949787489451,86:0.03219949787489451):0.17503222233260063,(45:0.017591236215728223,94:0.017591236215728223):0.18964048399176692):0.040289566553747935,111:0.24752128676124308):0.3467870959051167):0.3300506791940214):0.355313383051572,(((((((236:0.7349319294995935):0.1060610571868732):0.03944006506998865):0.0775329193305736):0.014186811376566189):0.2636542986745669):0.002114508379411406):0.04175085539437973):0.010792873641607192):0.14244055560279056):0.13704589008064771):0.042956592966824636):0.11979297378827536):0.1616741410359196,(((((35:0.5782526393646168):0.012970052188087111):0.5177675311410874):0.36692596807395095):0.04523519093679418,(((((((((211:0.36616875213493794):0.07379050553556743):0.09240672376110304):0.11000994027865496,((((121:0.3322929367219407,159:0.3322929367219407):0.16814303430936084):0.01463948010138183,10:0.5150754511326834):0.08334241785633001):0.043958052721249974):0.07793440141201247):0.014375082143032625):0.16257487491722755):0.4802322834943573,((((219:0.3862334779611709,114:0.3862334779611709):0.5225168133863125,(((160:0.0995536332436231,127:0.0995536332436231):0.2285668994570642):0.039843003336478056):0.5407867553103181):0.2082129450653578):0.17238223627645688):0.08814709098759521):0.006527587862507511):0.13713123016513562):0.3732240903234818):0.22896790267142003,(((((((((((((((42:0.4241004269162314,161:0.4241004269162314):0.04886338982182892):0.04897812286788539,((59:0.04626858886278473,30:0.04626858886278473):0.3274362112137248,207:0.3737048000765095):0.14823713952943618):0.5175644010452773,((69:0.5041606259847677):0.3168991851485383):0.218446529517917):0.026114645996676566,(((154:0.1946664410900527,74:0.1946664410900527):0.2158928831153264,(152:0.4015975230947868):0.008961801110592305):0.41494843548179894,(((((107:0.3766584818090162):0.2857836812525454,((88:0.3736316787398084,200:0.3736316787398084):0.25155926244500626):0.0372512218767469):0.009564035857723363):0.0063664663943663324,101:0.6783726653136513):0.01326105604036254):0.13387403833316425):0.24011322696072157):0.031243061705280573,((((138:0.4386622228093717):0.3323117553957604):0.04618996646483775):0.239835195997115):0.0398649076860953):0.0947324717274971):0.269069516608895,(((((((((((((79:0.11211745172100596,212:0.11211745172100596):0.05319121815408856):0.005293611760161632):0.10301883598780703,82:0.2736211176230632):0.18666824042432584):0.014771496517346439):0.07462525517953744):0.18679109191585264,235:0.7364772016601255):0.1387364300124001):0.0739889944819303):0.0639896908972466):0.04250068534935325):0.3508980837148803,(((((((((185:0.2925293030227234):0.1562216561670433,230:0.4487509591897667):0.04881259516803205):0.18632855798023318,(((((180:0.10502877924887644):0.12942839642979465,((155:0.056331038895975016,53:0.056331038895975016):0.12404803586902835,(115:0.10310711691621854,47:0.10310711691621854):0.07727195784878482):0.054078100913667715):0.027281350236161295,242:0.2617385259148324):0.2266784992072739,(((72:0.05571036530712714,44:0.05571036530712714):0.12217386013969955,87:0.1778842254468267):0.061749174821942976,224:0.23963340026876967):0.2487836248533366):0.024949902744727526,((78:0.3232306519751287,108:0.3232306519751287):0.07811221568637183):0.11202406020533329):0.17052518447119813):0.3343521546993391):0.14078718006501556):0.07871842204764423):0.10331217049307906):0.02544618387418285,(((((((((((((((237:0.2583299982576541):0.22951007825704028):0.18369731654048382):0.16691282620794):0.020850345304575413):0.015937366433874223):0.01411639985387092):0.06279173930680826):0.10962686599668547,((((((90:0.2811005327299019):0.0887445358621961,(93:0.3533501535020718):0.016494915090026208):0.16098762139325107):0.19483207805907932):0.022828470516035537):0.1818843615121788):0.13139533608628984):0.06500744366185152,(((((61:0.021546584301352034,46:0.021546584301352034):0.344142745051379,70:0.365689329352731):0.08940911502227822,(157:0.06065352159978854,213:0.06065352159978854):0.3944449227752207):0.4448553189892812,((((199:0.17317170680705862,33:0.17317170680705862):0.08454901978202889):0.5197085655621292):0.026036736565057117):0.09648773464801663):0.12099209756631146,(((((116:0.26736825607667125):0.04783629408263801):0.003256855981669027):0.3357064188081358,((205:0.47080767479562846):0.14051526189731378,((113:0.22557136133512268):0.2073587081558772):0.17839286720194236):0.04284488825617183):0.307507747966552,((((((133:0.18571664984559622,39:0.18571664984559622):0.17867471364482457,((135:0.0658969433606229,119:0.0658969433606229):0.22743321045677778):0.0710612096730201):0.329092908827072):0.04555841519489978):0.12628732463694536,(((192:0.7601879802148701):0.026963297231470618):0.06068862113203921):0.017490113570957977):0.025588099317396917):0.07075746144893125):0.059270288014935835):0.10583451889018214):0.0030242958278119403):0.015465737556799475):0.10320741178706783,((((((103:0.24626376861760324,89:0.24626376861760324):0.12744868322911307):0.07466468208771193,(206:0.2759212994177287,71:0.2759212994177287):0.17245583451669955):0.10824029983607808,(62:0.3091827356676293):0.247434698102877):0.0809251028563962):0.49155171365805117,(((((64:0.5319160810446424):0.059550006859657945):0.2586346015866312):0.01758373547152714,(((130:0.048359004317534815,3:0.048359004317534815):0.44896214257134437):0.07522974332834287):0.2951335347452366):0.03144437451077775,((((((((129:0.02217996438076053,231:0.02217996438076053):0.20079958631531447,244:0.222979550696075):0.2946752848818519):0.012656799000299701,58:0.5303116345782266):0.019679586316499353,50:0.549991220894726):0.025029094913389782):0.07522493457638535,153:0.6502452503845011):0.08861795875904366):0.16026559032969168):0.22996545081171726):0.1193835747075096):0.008850564382922643):0.04501758695019498):0.06416224719171182):0.040082862598643354):0.054074950573636205):0.0074844678674776954,(((((201:0.20357841368630236,166:0.20357841368630236):0.3434955641646298,(((141:0.012266430667138728,122:0.012266430667138728):0.5260017224092914):0.00239774103653545):0.00640808373796653):0.7625820889503805,(((((17:0.929531119006056):0.013901918035597038,(((((171:0.07242909393280295,105:0.07242909393280295):0.23479701936494912,8:0.30722611329775207):0.11523249249406309,214:0.42245860579181516):0.14850950427796006):0.29589919873956205):0.07656572823231578):0.023237353600260358):0.06386482739098565):0.24070979484081634,(((((81:0.5348631098745043):0.11637661069513672):0.3412667862870975):0.034246836978997):0.08688807903336637):0.15760359000461355):0.03841105392759725):0.0033997287112403907,(((((((68:0.02789630554792666,67:0.02789630554792666):0.10076698096962167,194:0.12866328651754833):0.4402161678399219):0.08150727206094377):0.10347433302491194):0.18514800536999498,(((124:0.05467586259720836,55:0.05467586259720836):0.6502890380379189):0.0996766613138651,((43:0.5270497024277359):0.23856211230281055,((76:0.5435674940506248):0.04143818622863926,((222:0.14637338168470126):0.4314734671151026):0.00715883147946017):0.18060613445128237):0.03902974721844599):0.13436750286432853):0.35330057839489504):0.020746152304337073):0.08288253594316153):0.07221217310133543):0.011586884164399347):0.026838557511651318,((((((((((131:0.46907201670194976):0.14114594598201302):0.14270389478931533):0.02353714022280573):0.1912724922352007,(((((36:0.011349922960334435,14:0.011349922960334435):0.1833596050516615):0.1008916069157082,(209:0.11182495242383439,240:0.11182495242383439):0.18377618250386973):0.09496216216272835):0.21798333319191565,((51:0.0035453008061563374,229:0.0035453008061563374):0.5728941509819325):0.03210717849425926):0.3591848596489364):0.006808677675159691):0.05209742884029245):0.1690511914287287):0.006867478995761456,((((((((49:0.22758379023380604,178:0.22758379023380604):0.42133647875555336):0.020351918918371403,(((91:0.11073058060257779):0.2215470617281734,27:0.3322776423307512):0.14240197672737986,((60:0.18721514171821152,21:0.18721514171821152):0.06417088823374106,((65:0.15128689471622314,95:0.15128689471622314):0.0067865726840588,5:0.15807346740028194):0.09331256255167064):0.22329358910617847):0.19459256884959975):0.0010930897008205598,((((((234:0.13697614690031212,99:0.13697614690031212):0.1212878255135239):0.03435121850887368,((7:0.10231532304161384,20:0.10231532304161384):0.0516554105874496):0.13864445729364627):0.18149349857988994,((123:0.1139493765116022):0.07439959109231786,172:0.18834896760392006):0.2857597218986796):0.003475660991485885,(((139:0.07492552776593131,98:0.07492552776593131):0.24780331920546006):0.1535526813866661):0.001302822136028059):0.05115386060759386,((132:0.24055708552318356):0.11308705432167487,142:0.35364413984485843):0.17509407125682097):0.14162706650687196):0.26770654920188974):0.11390806361005201,((((((238:0.37053873818867133):0.03917307550600313):0.01863477310621553):0.055451223928164595):0.234130862004567):0.2947007272612927):0.03935049042557881):0.09874570459598808,(((((202:0.4665626978637163):0.48419729724508365,((((((((177:0.004259389439384087,140:0.004259389439384087):0.06344738090632385,215:0.06770677034570793):0.2815523935976807):0.2337381956013651):0.07646012161597993):0.004243017666983651):0.13970436378605466):0.04038042079290327):0.10697471170212469):0.03552944118151302):0.10222983110145667):0.05686154171644375,((((((145:0.28341346497475284):0.19128884417966763,162:0.47470230915442047):0.16424582016417655,(((40:0.22392905261685803,16:0.22392905261685803):0.06077910259057928):0.3302026166046108,(((149:0.0791638720399086,156:0.0791638720399086):0.039560932068283705,225:0.1187248041081923):0.28923515555720103,179:0.40795995966539333):0.20695081214665478):0.024037357506548895):0.23532349664389995,(((163:0.0015754429076402232,125:0.0015754429076402232):0.24118348050045535,18:0.24275892340809557):0.35817195904686927):0.2733407435075321):0.08721296138400114,((((((220:0.0304985617330793,110:0.0304985617330793):0.00863604774277027,106:0.03913460947584957):0.28499889763535835):0.17912703229136917):0.3375226540979446):0.014673163724781002,(((19:0.18875014968163129):0.01607204231251247,13:0.20482219199414375):0.05745086620891504):0.5931832990222439):0.10602823012119544):0.10346825662582781,(((((216:0.3951313616811536,52:0.3951313616811536):0.3884246110439733):0.1548355231716938):0.1004936129642322):0.021680292450313443,((((((((136:0.5187991715210944):0.015100556212080951):0.08647930635924905,((245:0.22423175430736375):0.15958306301743796,151:0.3838148173248017):0.23656421676762274):0.0307294654231558,117:0.6511084995155803):0.04984065823744177,((118:0.07732203410424665):0.32372853571581706):0.2998985879329583):0.0647311723643027):0.12170616926081945):0.05698372615466529,((((38:0.21100802668854302,109:0.21100802668854302):0.3469551396440653):0.25371274627662044,(32:0.6457470832204484):0.1659288293887804):0.11765267690171721):0.01504163602186348):0.11619517577855687):0.004387442660959584):0.08042796513588746):0.005344785908267813):0.03579227956515596):0.016038392289589698):0.10702577115886203):0.19699390820301177):0.13443669613829445):0.03583273364763073,(((((((63:0.008745783438392607,100:0.008745783438392607):0.0346849214713818,28:0.04343070490977441):0.2166861390994037,66:0.2601168440091781):0.6292545816863238):0.3868382379538642):0.1505323157414149,(((((((181:0.2814908996940111,208:0.2814908996940111):0.05568228416389598):0.5705219240408905):0.20073068790473103):0.04474427874441411,((((102:0.3584809217421019):0.056484176013878784,((41:0.018499592191076886,120:0.018499592191076886):0.25668984144183504,1:0.27518943363291193):0.13977566412306874):0.47067483485130546):0.20344098098620433):0.06408916095445227):0.17429198399099954):0.07843885990994615):0.02084106094189253):0.17755318188097502):0.07255021474726986):0.23484507995615922):0.1565052829061131,((((((((((4:0.2509146863780578):0.032696582398095586,165:0.2836112687761534):0.01782696440852849):0.0672297069232104,(175:0.28696340345513116):0.08170453665276112):0.21689806720239613):9.859962522451582E-5,(73:0.5819376406336494):0.0037269663018635324):0.1867452643800538,((((54:0.10983208776720721,9:0.10983208776720721):0.20167938981497846,56:0.31151147758218567):0.08956549663621338):0.05734185318501561,((84:0.07463738743032255,217:0.07463738743032255):0.3750026945181548,168:0.4496400819484774):0.008778745454937287):0.31399104391215205):0.8088471308087866):0.11612003829088668,(((((((((((195:0.1626887650299671,148:0.1626887650299671):0.24798994494668003):0.08796827653686545):0.08289888859193884):0.08267020430911498):0.10147140580106928):0.12801866552207763):0.06831216256328698):0.09596110427041737):0.0763897647179197):0.33117812394545343,(((((((((48:0.6674568508058414):0.21245197206351474):0.026924286524729668):0.06887362696177357):0.03290265210170795,(((15:0.8228157343934843):0.1306012800581311):0.004723537712539638,(25:0.7225309636477493):0.2356095885164058):0.050468836293412256):0.2812539220150916,((((((((((176:0.40448780376855664):0.15896664994131027):0.034609591534021655,77:0.5980640452438886):0.3279239423525544):0.007893348990195781):0.092422219730661,193:1.0263035563172997):0.035292908387997146):0.07468597529227772,((((((12:0.07076058964647514,92:0.07076058964647514):0.21414114144085605,23:0.2849017310873312):0.38482005694835064,189:0.6697217880356818):0.05005223807170456):0.20790767174938307):0.10046795695630761,((((134:0.020434779694522565):0.6743911252862522):0.19992829117104494):0.07957332631330982):0.05382213234794753):0.10813278518449754):0.01609087084087868,((85:0.025400280250206908,182:0.025400280250206908):0.40400983655545586):0.7229631940327905):0.12421314506710956,(((((((((((241:0.05822482764960091):0.4364350336815934,(11:0.29958644524963063):0.1950734160815637):0.2443170849218661):0.03997708058949012,126:0.7789540268425506):0.04963715084153453):0.0214569641504454):0.11094430297978453):0.13813436408508584):0.023205353211795066,((((150:0.6575863146834671):0.06269172939720491,((227:0.06423486056776584,210:0.06423486056776584):0.5514896992000478):0.10455348431285838):0.11307470873597825):0.17492402576760946):0.11405538352693623):0.005154751165386218):0.13122777215302261):0.017871770475958115):0.013276854567096041):0.09255231750765325):0.03658295955345214,((((((((22:0.114182440439905,191:0.114182440439905):0.4751376467682642):0.08688083410997272):0.20824148224705996):0.09454371223921032,143:0.9789861158044122):0.025434963872074112):0.18045820973938076):0.07156069146227217):0.16255860665562505):0.03990426993392382,(((((183:0.11405807111030786):0.3588705661923077):0.44758369155829625,((83:0.4323823137566718):0.3230076651853868):0.16512234991885322):0.36393986807653356):0.15036695905451558):0.024083701475727137):0.006644448767102684):0.23182973418044917):0.05432609977817593):0.31649259868788227):0.05514763581814014):0.10705313422705925):0.0030315770852450963);";
        tips[2] = 245;

        Tree tree ;

        double logLvc ;

        for (int j=0;j<trees.length;j++){
//        for (int j=0;j<1;j++){


            writer = new PrintWriter(new FileWriter("/Users/Denise/Documents/Projects/BDSIR/coalComp/vary_S_"+ j +".txt"));
            writer.println("#tree = " + trees[j]);
            writer.println("#tips = " + tips[j]);

            tree = new TreeParser(trees[j],false);

            TreeIntervals treeIntervals = new TreeIntervals();
            treeIntervals.init(tree);

            double step = (upper - lower) / (steps);

            Volz2009Coalescent vc;
            VolzSIR vvc;
            Coalescent coal;
            BDSIR bdsir;

            Double current;

            Double beta = 0.005;
            Double death = 2.;
            Double origin = 2.5;

            writer.println("S\tvolzSIR\tvolz2009\tBDSIR");

            for (int i=1; i<=steps; i++){

                current = lower + i*step;

//            writer.println("beta = " + current);
                writer.print(current + "\t");

                vc =  new Volz2009Coalescent();
                vc.setInputValue("treeIntervals", new TreeIntervals(tree));
                vc.setInputValue("beta", new RealParameter(new Double[]{beta}));
                vc.setInputValue("delta", new RealParameter(new Double[]{death}));
                vc.setInputValue("S0", new RealParameter(new Double[]{current}));
                vc.setInputValue("T", new RealParameter("2.5"));

                try{

                    vc.initAndValidate();
                    logLvc =  vc.calculateLogP();

                }catch(Exception e){
                    logLvc = Double.NaN;
                }

                vvc = new VolzSIR();
                vvc.setInputValue("beta", new RealParameter(new Double[]{beta}));
                vvc.setInputValue("gamma", new RealParameter(new Double[]{death}));
                vvc.setInputValue("n_S0", new RealParameter(new Double[]{current}));
                vvc.setInputValue("origin", new RealParameter("2.5"));
                vvc.setInputValue("integrationStepCount", 1000);

                vvc.initAndValidate();

                HybridSEIREpidemic sir = new HybridSEIREpidemic();
                sir.initByName(
                        "tree", tree,
                        "birth", new RealParameter(new Double[]{beta}),
                        "death",new RealParameter(new Double[]{death}),
                        "sampling", "0",
                        "origin", new RealParameter("2.5"),
                        "S0", new RealParameter(new Double[]{current}),
                        "Nt", "10001",
                        "Nsamples", "101" ,
                        "simulationType", "SAL"
                    ,"isDeterministic", "true"
                );

                sir.initTraj(0.005, 0., new Double[]{death}, new Double[]{0.}, origin, tree.getLeafNodeCount(), 100, 1000, sir.times);


                bdsir = new BDSIR();
                bdsir.setInputValue("tree", tree);
                bdsir.setInputValue("birthRate", new RealParameter(new Double[]{beta*current}));
                bdsir.setInputValue("deathRate", new RealParameter(new Double[]{death}));
                bdsir.setInputValue("samplingRate", new RealParameter("0"));
                bdsir.setInputValue("rho", new RealParameter(new Double[]{tips[j]/245.}));
                bdsir.setInputValue("S0", new RealParameter(new Double[]{current}));
                bdsir.setInputValue("origin", new RealParameter("2.5"));
                bdsir.setInputValue("dS", new RealParameter(sir.get_dS()));
                bdsir.setInputValue("dR", new RealParameter(sir.get_dR()));
                bdsir.setInputValue("checkTreeConsistent", false);

                bdsir.initAndValidate();

                coal = new Coalescent();
                coal.initByName("treeIntervals", treeIntervals, "populationModel", vvc);


                double logLvvc =  coal.calculateLogP();
//            writer.println("volzSIR (Tim)  logL = " + logLvvc);
                writer.print((Double.isInfinite(logLvvc)?"NA":logLvvc) + "\t");


//            writer.println("volz2009coalescent logL = " + logLvc);
                writer.print((Double.isInfinite(logLvc)?"NA":logLvc) + "\t");


                double logLbdsir ;
                try{

                    logLbdsir =  bdsir.calculateTreeLogLikelihood(tree);

                }catch(Exception e){
                    logLbdsir = Double.NaN;
                }

//            writer.println("bdsir logL = " + logLbdsir);
                writer.println((Double.isInfinite(logLbdsir)?"NA":logLbdsir) + "\t");

                //        assertEquals(-19.0198, vc.calculateLogP(), 1e-5);
//            assertEquals(logLvvc, logLvc, 1e-5);



            }
            writer.flush();
            writer.close();

        }
    }

    @Test
    public void test() throws Exception {



        Volz2009Coalescent vc =  new Volz2009Coalescent();

        Tree tree = new TreeParser("((3 : 4, 4 : 4) : 1 , (1 : 2, 2 : 2) : 3);",false);

        TreeIntervals treeIntervals = new TreeIntervals();
        treeIntervals.init(tree);
        vc.setInputValue("treeIntervals", new TreeIntervals(tree));
        vc.setInputValue("beta", new RealParameter("0.003"));
        vc.setInputValue("delta", new RealParameter("1.5"));
        vc.setInputValue("S0", new RealParameter("1000."));
        vc.setInputValue("T", new RealParameter("6."));

        vc.initAndValidate();

        VolzSIR vvc = new VolzSIR();
        vc.setInputValue("treeIntervals", treeIntervals);
        vvc.setInputValue("beta", new RealParameter("0.003"));
        vvc.setInputValue("gamma", new RealParameter("1.5"));
        vvc.setInputValue("n_S0", new RealParameter("1000."));
        vvc.setInputValue("origin", new RealParameter("6."));
        vvc.setInputValue("integrationStepCount", 1000);

        vvc.initAndValidate();

        Coalescent coal = new Coalescent();
        coal.initByName("treeIntervals", treeIntervals, "populationModel", vvc);


        double logLvvc =  coal.calculateLogP();
        System.out.println("volzSIR (Tim)  logL = " + logLvvc);

        double logLvc =  vc.calculateLogP();
        System.out.println("volz2009coalescent logL = " + logLvc);


        //        assertEquals(-19.0198, vc.calculateLogP(), 1e-5);
        assertEquals(logLvvc, logLvc, 1e-5);



    }


}
